(function(o,t){typeof exports=="object"&&typeof module<"u"?t(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],t):(o=typeof globalThis<"u"?globalThis:o||self,t(o["mybricks-render-vue2"]={},o.Vue))})(this,function(exports,Vue){"use strict";var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var comlibCore={exports:{}};(function(module,exports){(function(o,t){module.exports=t()})(commonjsGlobal,()=>(()=>{var __webpack_modules__={356:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function __WEBPACK_DEFAULT_EXPORT__({data,outputs,inputs,onError}){inputs.from((val,relOutpus)=>{var _a;const script=(_a=data.exchange)===null||_a===void 0?void 0:_a.script;if(script){let fn,returnVal,isOk;try{eval(`fn = ${script}`),returnVal=fn(val),isOk=!0}catch(o){console.error(o),onError(`数据转换错误:${o.message}`,o)}isOk&&outputs.to(returnVal)}else onError("未配置转换规则")})}__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__})}},__webpack_module_cache__={};function __webpack_require__(o){var t=__webpack_module_cache__[o];if(t!==void 0)return t.exports;var e=__webpack_module_cache__[o]={exports:{}};return __webpack_modules__[o](e,e.exports,__webpack_require__),e.exports}__webpack_require__.d=(o,t)=>{for(var e in t)__webpack_require__.o(t,e)&&!__webpack_require__.o(o,e)&&Object.defineProperty(o,e,{enumerable:!0,get:t[e]})},__webpack_require__.o=(o,t)=>Object.prototype.hasOwnProperty.call(o,t),__webpack_require__.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})};var __webpack_exports__={};return(()=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>f,getCom:()=>S});const o=JSON.parse('{"title":"Fn计算","namespace":"mybricks.core-comlib.fn","author":"CheMingjun","author_name":"车明君","version":"1.0.0","description":"Fn计算","icon":"./icon.png","runtime":"./Fn.tsx","rtType":"js","visibility":false}'),t=JSON.parse('{"visibility":false,"title":"变量","namespace":"mybricks.core-comlib.var","author":"CheMingjun","author_name":"车明君","version":"1.0.0","description":"变量","icon":"./icon.png","data":"./data.json","runtime":"./Var.tsx","editors":"./editors.tsx","rtType":"js","inputs":[{"id":"get","title":"读取","schema":{"type":"any"},"rels":["return"]},{"id":"set","title":"赋值","schema":{"type":"follow"},"rels":["return"]},{"id":"reset","title":"重置","schema":{"type":"any"}}],"outputs":[{"id":"return","title":"完成","schema":{"type":"unknown"}},{"id":"changed","title":"当值发生变化","schema":{"type":"unknown"}}]}');function e(b){if(b&&typeof b=="object")try{return JSON.parse(JSON.stringify(b))}catch{return b}return b}const n=JSON.parse('{"title":"类型转换","visibility":false,"namespace":"mybricks.core-comlib.type-change","author":"CheMingjun","author_name":"车明君","version":"1.0.0","description":"类型转换","icon":"./icon.png","runtime":"./rt.tsx","editors":"./editors.tsx","rtType":"js","inputs":[{"id":"from","title":"从","schema":{"type":"follow"},"rels":["to"]}],"outputs":[{"id":"to","title":"到","schema":{"type":"follow"},"conMax":1,"editable":true}]}');var s=__webpack_require__(356);const l=JSON.parse('{"deprecated":true,"visibility":false,"title":"连接器","namespace":"mybricks.core-comlib.connector","author":"MyBricks","author_name":"MyBricks","version":"1.0.0","description":"连接器","runtime":"./runtime.ts","editors":"./editors.tsx","icon":"./icon.svg","rtType":"js-autorun","inputs":[{"id":"call","rels":["then","catch"],"title":"调用","schema":{"type":"object"}}],"outputs":[{"id":"then","title":"结果","schema":{"type":"unknown"}},{"id":"catch","title":"发生错误","schema":{"type":"string"}}]}');function r({env:b,data:c,outputs:u,onError:w},h={}){if(c.connector)try{b.callConnector(c.connector,h,c.connectorConfig).then(_=>{u.then(_)}).catch(_=>{u.catch(_)})}catch(_){console.error(_),u.catch(`执行错误 ${_.message||_}`)}else u.catch("没有选择接口")}const p=JSON.parse('{"visibility":false,"title":"作用域输入","namespace":"mybricks.core-comlib.frame-input","author":"CheMingjun","author_name":"车明君","version":"1.0.0","description":"作用域输入","rtType":"js","runtime":"./runtime.ts","editors":"./editor.tsx","inputs":[{"id":"getCurValue","title":"获取","schema":{"type":"any"},"rels":["return"]}],"outputs":[{"id":"return","title":"结果","schema":{"type":"follow"}}]}'),x=JSON.parse('{"visibility":false,"title":"打开对话框","namespace":"mybricks.core-comlib.scenes","author":"CheMingjun","author_name":"车明君","version":"1.0.0","description":"切换场景","icon":"./icon.png","runtime":"./runtime.ts","data":"./data.json","rtType":"js","inputs":[{"id":"open","title":"打开","schema":{"type":"any"}}]}'),i={id:"mybricks-core-comlib",title:"Mybrics核心组件库",author:"CheMingjun",icon:"",version:"1.0.1",comAray:[y({comDef:o,rt:function({inputs:b,outputs:c}){}}),y({comDef:t,rt:function({env:b,data:c,outputs:u,inputs:w,_notifyBindings:h}){w.get((_,$)=>{const F=e(c.val!==void 0?c.val:c.initValue);$.return(F)}),w.set((_,$)=>{c.val=_;const F=e(_);u.changed(F,!0),h(F),$.return(F)}),w.reset(()=>{const _=c.initValue;c.val=_;const $=e(_);u.changed($,!0),h($)})}}),y({comDef:n,rt:s.Z}),y({comDef:l,rt:function({env:b,data:c,inputs:u,outputs:w,onError:h}){b.runtime&&(c.immediate?r({env:b,data:c,outputs:w}):u.call(_=>{r({env:b,data:c,outputs:w,onError:h},_)}))}}),y({comDef:p,rt:function({env:b,data:c,inputs:u,outputs:w}){b.runtime&&u.getCurValue((h,_)=>{_.return(h)})}}),y({comDef:x,rt:function({env:b,data:c,inputs:u,_inputs:w,_inputsCallable:h}){u.open(_=>{b.canvas.open(c._sceneId,_,c._sceneShowType==="popup"?null:c.openType),h._open(_)})}})]},f=i;function S(b){return i.comAray.find(c=>c.namespace===b)}function y({comDef:b,rt:c,data:u}){return Object.assign(b,{runtime:c,data:u})}})(),__webpack_exports__})())})(comlibCore);var comlibCoreExports=comlibCore.exports;const coreLib=getDefaultExportFromCjs(comlibCoreExports),globalKey="__IOEventList__",ioLogger={log:(...o)=>{window[globalKey]||(window[globalKey]=[]),window[globalKey].push(o[0]),console.log(...o)}};function log(o){console.log(`%c[Mybricks]%c ${o}
`,"color:#FFF;background:#fa6400","","")}function logInputVal(o,t,e,n){let s;try{s=JSON.stringify(n)}catch{s=n}ioLogger.log(`%c[Mybricks] 输入项 %c ${o||t.title||t.namespace} | ${e} -> ${s}`,"color:#FFF;background:#000","","")}function logOutputVal(o,t,e,n){let s;try{s=JSON.stringify(n)}catch{s=n}ioLogger.log(`%c[Mybricks] 输出项 %c ${o||t.title||t.namespace} | ${e} -> ${s}`,"color:#FFF;background:#fa6400","","")}function isNumber(o){return typeof o=="number"&&!isNaN(o)}function uuid$1(o=5,t=8){const e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=[];if(t=t||e.length,o)for(let s=0;s<o;s++)n[s]=e[0|Math.random()*t];else{let s;n[8]=n[13]=n[18]=n[23]="-",n[14]="4";for(let l=0;l<36;l++)n[l]||(s=0|Math.random()*16,n[l]=e[l==19?s&3|8:s])}return n.join("")}function convertCamelToHyphen(o){return o.replace(/([A-Z])/g,"-$1").toLowerCase()}const toFixed=function o(t,e){var n=Math.pow(10,e+1),s=Math.floor(t*n);return Math.round(s/10)*10/n},createPxReplacer=function o(t,e,n,s){return function(l,r){var p=parseFloat(r);return!r||p<=e?l:"".concat(toFixed(p/t,n)).concat(s)}},remReplace=createPxReplacer(12,0,5,"rem"),vwReplace=createPxReplacer(3.75,0,5,"vw"),REG_PX=/"[^"]+"|'[^']+'|url\([^)]+\)|(\d*\.?\d+)px/g,pxToRem=o=>o.replace(REG_PX,remReplace),pxToVw=o=>o.replace(REG_PX,vwReplace),ROOT_FRAME_KEY="_rootFrame_";function executor(o,{observable:t}){const{json:e,getComDef:n,env:s,ref:l,onError:r,logger:p,debug:x,debugLogger:i,scenesOperate:f}=o,{slot:S,coms:y={},comsAutoRun:b={},cons:c=[],pinRels:u={},pinProxies:w={},pinValueProxies:h={}}=e,_=s,$={},F={},B={},q={},rt={};Object.keys(c).forEach(g=>{const m=c[g],{startPinParentKey:d}=m[0];d&&(rt[d]=g)});const et={},nt={};function ut(g,m){if(g==="com"){const{com:d,pinHostId:O,val:C,fromCon:I,notifyAll:a,comDef:j}=m;i?i("com","output",{id:d.id,pinHostId:O,val:C,fromCon:I,notifyAll:a,comDef:j}):logOutputVal(d.title,j,O,C)}else if(g==="frame"){const{comId:d,frameId:O,pinHostId:C,val:I,sceneId:a}=m;i&&i("frame","output",{comId:d,frameId:O,pinHostId:C,val:I,sceneId:a})}}function dt(g){const{com:m,pinHostId:d,val:O,frameKey:C,finishPinParentKey:I,comDef:a}=g;i?i("com","input",{id:m.id,pinHostId:d,val:O,frameKey:C,finishPinParentKey:I,comDef:a}):logInputVal(m.title,a,d,O)}function at(g,m,d,O,C){function I(a,j){var T,P;const v=w[a.comId+"-"+a.pinId];if(v){if(nt[`${v.frameId}-${v.pinId}`]=m,O&&O.finishPinParentKey!==a.startPinParentKey)return;if(v.type==="frame"){const E=it(a.comId,j);let R;R={id:uuid$1(10,16),frameId:v.frameId,parent:j,proxyComProps:E};const Z=a.def.namespace==="mybricks.core-comlib.frame-output";Z&&(v.frameId=j.proxyComProps.id,R=j.parent),G(v,m,R),Z||z({frameId:v.frameId,scope:R});return}}if(a.type==="com")O?O.finishPinParentKey===a.startPinParentKey&&A(a,m,j):A(a,m,j);else if(a.type==="frame"){if(O&&O.finishPinParentKey!==a.startPinParentKey)return;if(a.comId){if(a.direction==="inner-input"){const E=F[a.comId+"-"+a.frameId+"-"+((T=j==null?void 0:j.parent)!=null&&T.id?j.parent.id+"-":"")+a.pinId];E&&E(m)}else if(a.direction==="inner-output"&&a.pinType==="joint"){const E=c[a.comId+"-"+a.frameId+"-"+a.pinId];E&&at(E,m)}}else{const E=j==null?void 0:j.proxyComProps;if(E){const R=E.outputs[a.pinId];if(R){R(m,j.parent);return}}(P=q[a.pinId])==null||P.call(q,m)}}else throw new Error("尚未实现")}g.forEach(a=>{if(x&&a.isIgnored)return;let j=d;if(C){const v=a.frameKey;if(!v)throw new Error("数据异常，请检查toJSON结果.");if(v===ROOT_FRAME_KEY)I(a,{});else{const T=v.split("-");if(T.length>=2){const P=K(T[0],T[1],null,C);P.curScope?(P.curScope!==j&&(j=P.curScope),I(a,j)):P.pushTodo(E=>{E!==j&&(j=E),I(a,j)})}}}else{const v=a.frameKey.split("-");if(v.length>=2&&!j){const T=K(v[0],v[1],null,!1);if((T==null?void 0:T.type)==="scope"&&!(T!=null&&T.curScope)){T.pushTodo(P=>{P!==j&&(j=P),I(a,j)});return}}I(a,j)}})}function it(g,m){var It;const d=y[g];if(!d)return null;const O=g+(d.frameId||ROOT_FRAME_KEY);let C=$[O];C||(C=$[O]={});let I,a=m;for(!a&&d.parentComId&&d.frameId&&(a=(It=$[`${d.parentComId}-${d.frameId}`])==null?void 0:It.curScope);a;){const D=a.id+"-"+g;if(a.frameId===d.frameId){I=a.id;const k=C[D];if(k)return k;break}a=a.parent}const j=(I?I+"-":"")+g,v=C[j];if(v)return v;const T=d.def,P=d.model;let E=o?JSON.parse(JSON.stringify(P)):P;const R=t(E),Z={},W={},M={},N=(D,k,V,J)=>{let L=W[D];L||(W[D]=L=[]),L.push({val:k,fromCon:V,fromScope:J})},H=function(D){return new Proxy({},{ownKeys(k){return d.inputs},getOwnPropertyDescriptor(k){return{enumerable:!0,configurable:!0}},get(k,V){return function(J){if(Object.prototype.toString.call(V)==="[object Symbol]")return;const L=D==null?void 0:D.inputs;if(L){const U=L[V];typeof U=="function"&&U(J)}Z[V]=J;const Y=W[V];Y&&(Y.forEach(({val:U,fromCon:lt,fromScope:yt})=>{J(U,new Proxy({},{get(mt,Ct){return function(vt){if(Object.prototype.toString.call(Ct)==="[object Symbol]")return;const gt=pt()[Ct];if(typeof gt=="function")gt(vt,yt||a,lt);else throw new Error(`outputs.${Ct} not found`)}}}))}),W[V]=void 0)}}})},Q=new Proxy({},{get(D,k){return function(V){if(Object.prototype.toString.call(k)==="[object Symbol]")return;const J=u[g+"-"+k];if(J){const L={},Y={};return J.forEach(U=>{L[U]=lt=>{Y[U]=lt}}),Promise.resolve().then(()=>{A({comId:g,def:T,pinId:k},V,m,Y)}),L}else A({comId:g,def:T,pinId:k},V,m)}}}),ct=new Proxy({},{get(D,k){return function(V){if(Object.prototype.toString.call(k)==="[object Symbol]")return;const J=w[g+"-"+k];J&&(f==null||f.inputs({...J,value:V,parentScope:ft}))}}}),pt=function(D){return new Proxy({},{ownKeys(k){return d.outputs},getOwnPropertyDescriptor(k){return{enumerable:!0,configurable:!0}},get(k,V,J){const L=function(Y,U,lt,yt){if(Object.prototype.toString.call(V)==="[object Symbol]")return;const mt=typeof U=="boolean"&&U;if(d.global&&mt&&!yt){f==null||f.exeGlobalCom({com:d,value:Y,pinId:V});return}const Ct=arguments,vt=D==null?void 0:D.outputs;if(vt){const ht=vt[V];typeof ht=="function"&&ht(Y)}let gt;U&&typeof U=="object"&&(gt=U);const Tt=n(T);ut("com",{com:d,pinHostId:V,val:Y,fromCon:lt,notifyAll:mt,comDef:Tt});const Ft=P.outputEvents;let st;if(Ft){const ht=Ft[V];if(ht&&Array.isArray(ht)){const Et=ht.find($t=>$t.active);if(Et){const{type:$t}=Et;switch($t){case"none":st=[];break;case"fx":const St=w[g+"-"+V];if((St==null?void 0:St.type)==="frame"){const bt=`${St.frameId}-${St.pinId}`;st=c[bt]||[],nt[bt]=Y}else st=[];break;case"defined":break;default:if(st=[],Array.isArray(s==null?void 0:s.events)){const bt=s.events.find(Pt=>{if(Pt.type===$t)return Pt});bt&&typeof bt.exe=="function"&&bt.exe({options:Et.options})}break}}}}st=st||c[g+"-"+V],st!=null&&st.length&&(Ct.length>=3?at(st,Y,gt,lt):at(st,Y,gt||m,lt,mt))};return L.getConnections=()=>c[g+"-"+V]||[],L}})},ot=new Proxy({},{get(D,k,V){return function(J){if(Object.prototype.toString.call(k)==="[object Symbol]")return;const L=M[k];L&&(L.forEach(Y=>{J(Y)}),M[k]=void 0)}}}),Ot=new Proxy({},{get(D,k,V){return function(J){if(Object.prototype.toString.call(k)==="[object Symbol]")return;const L=c[g+"-"+k];L&&(ut("com",{com:d,pinHostId:k,val:J,comDef:T}),at(L,J,m))}}});function _t(D){if(d.global){f==null||f._notifyBindings(D,d);return}const{bindingsTo:k}=d.model;if(k)for(let V in k){const J=it(V);if(J){const L=k[V];Array.isArray(L)&&L.forEach(Y=>{let U=J;const lt=Y.split(".");lt.forEach((yt,mt)=>{mt!==lt.length-1?U=U[yt]:U[yt]=D})})}}}const ft={id:d.id,title:d.title,frameId:d.frameId,parentComId:d.parentComId,data:R.data,style:R.style,_inputRegs:Z,addInputTodo:N,inputs:H(),inputsCallable:Q,_inputsCallable:ct,outputs:pt(),_inputs:ot,_outputs:Ot,clone(D){const k={inputs:H(D),outputs:pt(D)};return Object.setPrototypeOf(k,this),k},_notifyBindings:_t,logger:p,onError:x?D=>r({comId:g,error:D}):r};return C[j]=ft,ft}function xt(g,m){let d=nt[`${g}${m?`-${m.id}-${m.frameId}`:""}`];return typeof d>"u"&&(m!=null&&m.parent)&&(d=xt(g,m.parent)),d}function A(g,m,d,O){var P;const{comId:C,def:I,pinId:a,pinType:j,frameKey:v,finishPinParentKey:T}=g;if(j==="ext"){const E=$[C]||it(C,d);if(a==="show")E.style.display="";else if(a==="hide")E.style.display="none";else if(a==="showOrHide"){const R=E.style;R.display==="none"?R.display="":R.display="none"}}else if(j==="config"){const E=it(C,d),R=n(I);dt({com:E,pinHostId:a,val:m,frameKey:v,finishPinParentKey:T,comDef:R});const{extBinding:Z}=g,W=Z.split(".");let M=E;W.forEach((N,H)=>{H!==W.length-1?M=M[N]:M[N]=m})}else if((P=I.rtType)!=null&&P.match(/^js/gi)){const E=y[C];if(E){const R=it(C,d),Z=n(I);if(E.global){const ot=f==null?void 0:f.getGlobalComProps(C);ot&&(R.data=ot.data)}const W=d==null?void 0:d.id,M=(W?W+"-":"")+C;dt({com:E,val:m,pinHostId:a,frameKey:v,finishPinParentKey:T,comDef:Z}),B[M]||(B[M]=!0,Z.runtime({env:_,data:R.data,inputs:R.inputs,outputs:R.outputs,_notifyBindings:R._notifyBindings,_inputsCallable:R._inputsCallable,logger:p,onError:x?ot=>r({comId:C,error:ot}):r}));const{realId:N,realVal:H,isReady:Q,isMultipleInput:ct}=wt(g,m,R);typeof R._inputRegs[N]=="function"&&(ct&&Q||!ct)&&R._inputRegs[N](H,new Proxy({},{get(ot,Ot){return function(_t){if(Object.prototype.toString.call(Ot)!=="[object Symbol]"){if(h){const ft=h[`${C}-${a}`];ft&&(_t=xt(`${v}-${ft.pinId}`,d),typeof _t>"u"&&(_t=xt(`${v}-${ft.pinId}`,null)))}R.outputs[Ot](_t,d,g)}}}}))}}else{const E=it(C,d);if(!E)return;const R=n(I);dt({com:E,pinHostId:a,val:m,frameKey:v,finishPinParentKey:T,comDef:R});const{realId:Z,realVal:W,isReady:M,isMultipleInput:N}=wt(g,m,E),H=E._inputRegs[Z];if(N&&M||!N)if(typeof H=="function"){let Q;O?Q=O:Q=new Proxy({},{get(ct,pt){return function(ot){Object.prototype.toString.call(pt)!=="[object Symbol]"&&E.outputs[pt](ot,d,g)}}}),H(W,Q)}else E.addInputTodo(Z,W,g,d)}if(T){const E=c[rt[T]];E&&!u[`${C}-${a}`]&&at(E,void 0)}}function wt(g,m,d){const{pinId:O,comId:C}=g,I=O.indexOf(".");if(I!==-1){let a=O.substring(0,I);const j=O.substring(I+1);let v=et[C];v||(v=et[C]={}),v[j]=m;const T=new RegExp(`${a}.`),P=Object.keys(d.inputs).filter(E=>!!E.match(T));return Object.keys(v).length===P.length?(delete et[C],{isMultipleInput:!0,isReady:!0,realId:a,realVal:v}):{isMultipleInput:!0,isReady:!1}}return{isMultipleInput:!1,isReady:!0,realId:O,realVal:m}}function jt(g,m){let d;return g.comAry&&g.comAry.find(O=>{if(O.id===m)return d=O,O;if(O.slots){for(let C in O.slots)if(d=jt(O.slots[C],m),d)return d}}),d}function K(g,m,d,O){let C=g+"-"+m+(d?`-${d.id}`:""),I=$[C];if(O&&!I&&(I=$[Object.keys($).find(a=>a.startsWith(C))]),!I){const a=jt(S,g);if(!(a!=null&&a.slots))return null;const j=a==null?void 0:a.slots[m],v={};let T;if(d){const M=$[g+"-"+m];M&&(T=M.todo)}const P={scope:d,todo:T},E=new Proxy({},{get(M,N){return function(H){Object.prototype.toString.call(N)!=="[object Symbol]"&&(v[N]=H)}}}),R=new Proxy({},{get(M,N){const H=function(Q,ct){if(Object.prototype.toString.call(N)==="[object Symbol]")return;const pt=g+"-"+m+"-"+N,ot=c[pt];nt[`${pt}${ct?`-${ct.id}-${ct.frameId}`:""}`]=Q,ut("frame",{comId:g,frameId:m,pinHostId:N,val:Q}),ot&&at(ot,Q,ct||P.scope)};return H.getConnections=()=>c[g+"-"+m+"-"+N]||[],H}}),Z=new Proxy({},{get(M,N,H){return function(Q){Object.prototype.toString.call(N)!=="[object Symbol]"&&(F[C+"-"+N]=Q)}}});let W={};I=$[C]={type:j==null?void 0:j.type,run(M){P.scope=M;const N=(M==null?void 0:M.id)||"none";W[N]||(W[N]=!0,z({comId:g,frameId:m,scope:M})),Array.isArray(P.todo)&&(P.todo.forEach(H=>{Promise.resolve().then(()=>{H(M)})}),P.todo=void 0)},destroy(){Reflect.deleteProperty($,C)},_inputs:E,_inputRegs:v,inputs:R,outputs:Z,get curScope(){return P.scope},get todo(){return P.todo},pushTodo(M){P.todo||(P.todo=[]),P.todo.push(M)}}}return I}function z(g){const{comId:m,frameId:d,scope:O}=g,C=m?`${m}-${d}`:`${d}`,I=b[C];I&&I.forEach(a=>{const{id:j,def:v}=a;if(y[j]){const P=it(j,O),E=n(v);log(`${E.namespace} 开始执行`),E.runtime({env:_,data:P.data,inputs:P.inputs,outputs:P.outputs,_inputsCallable:P._inputsCallable,logger:p,onError:x?R=>r({comId:j,error:R}):r})}})}function G(g,m,d=void 0,O=!0){const{frameId:C,comId:I,pinId:a,sceneId:j}=g,v=I?`${I}-${C}`:`${C}`,T=c[v+"-"+a];nt[`${C}-${a}`]=m,O&&ut("frame",{comId:I,frameId:C,pinHostId:a,val:m,sceneId:j}),T?at(T,m,d):C!==ROOT_FRAME_KEY&&(f==null||f.open({frameId:C,todo:{pinId:a,value:m},parentScope:d.proxyComProps}))}const X={get(g,m,d,O){let C,I,a;for(let j=0;j<arguments.length;j++){const v=arguments[j];j>0&&typeof v=="string"&&(C=v),typeof v=="object"&&(v.inputs||v.outputs||v._inputs||v._outputs?a=v:(v.id||v.parent)&&(I=v))}if(C)return K(g,C,I);{const j=it(g,I);return a?j.clone(a):j}},getComInfo(g){return y[g]}};return typeof l=="function"&&l({run(){z({frameId:ROOT_FRAME_KEY})},inputs:new Proxy({},{get(g,m){return function(d,O=void 0,C=!0){Object.prototype.toString.call(m)!=="[object Symbol]"&&G({frameId:ROOT_FRAME_KEY,pinId:m,sceneId:O},d,void 0,C)}}}),outputs(g,m){q[g]=m},get:X.get,getComInfo:X.getComInfo}),X}function normalizeComponent(o,t,e,n,s,l,r,p){var x=typeof o=="function"?o.options:o;t&&(x.render=t,x.staticRenderFns=e,x._compiled=!0),n&&(x.functional=!0),l&&(x._scopeId="data-v-"+l);var i;if(r?(i=function(y){y=y||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!y&&typeof __VUE_SSR_CONTEXT__<"u"&&(y=__VUE_SSR_CONTEXT__),s&&s.call(this,y),y&&y._registeredComponents&&y._registeredComponents.add(r)},x._ssrRegister=i):s&&(i=p?function(){s.call(this,(x.functional?this.parent:this).$root.$options.shadowRoot)}:s),i)if(x.functional){x._injectStyles=i;var f=x.render;x.render=function(b,c){return i.call(c),f(b,c)}}else{var S=x.beforeCreate;x.beforeCreate=S?[].concat(S,i):[i]}return{exports:o,options:x}}const _sfc_main$6={props:{slotId:{type:String},propsSlot:{type:Object},params:{type:Object},props:{type:Object},propsStyle:{type:Object},onError:{type:Function},logger:{type:Object},env:{type:Object},_env:{type:Object},scope:{type:Object},getComDef:{type:Function},context:{type:Object}},created(){let o;const{propsSlot:t,scope:e,props:n,env:s,_env:l,getComDef:r,context:p,onError:x,logger:i,params:f}=this.$props;if(Object.assign(f,f.m),(t==null?void 0:t.type)==="scope"?(o={id:uuid(10,16),frameId:slotId},e&&(o.parent=e)):o=e,f){const S=f.inputValues;if(typeof S=="object")for(let y in S)n.inputs[y](S[y],o);typeof f.wrap=="function"&&f.wrap}n.run(o),this.slotProps={scope:o,env:s,_env:l,propsSlot:t,params:f,getComDef:r,context:p,inputs:f==null?void 0:f.inputs,outputs:f==null?void 0:f.outputs,_inputs:f==null?void 0:f._inputs,_outputs:f==null?void 0:f._outputs,onError:x,logger:i},this.slotComponent=RenderSlot}};var _sfc_render$6=function o(){var t=this,e=t._self._c;return e(t.slotComponent,t._b({tag:"component"},"component",t.slotProps,!1))},_sfc_staticRenderFns$6=[],__component__$6=normalizeComponent(_sfc_main$6,_sfc_render$6,_sfc_staticRenderFns$6,!1,null,null,null,null);const SlotRender=__component__$6.exports,com="_com_z9da4_2",flex="_flex_z9da4_7",style0$2={com,flex},_sfc_main$5={props:{com:{type:Object},getComDef:{type:Function},context:{type:Object},scope:{type:Object},props:{type:Object},env:{type:Object},_env:{type:Object},onError:{type:Function},logger:{type:Object}},components:{SlotRender},created(){var jt;const{_env:o,env:t,com:e,props:n,getComDef:s,onError:l,logger:r,context:p,scope:x}=this.$props,{pxToRem:i,pxToVw:f}=t,{id:S,def:y,name:b,slots:c={}}=e,{data:u,title:w,style:h,inputs:_,outputs:$,_inputs:F,_outputs:B,_notifyBindings:q}=n,rt=this.getStyleAry({env:t,def:y,style:h});if(Array.isArray(rt)){const K=(t==null?void 0:t.shadowRoot)||((jt=document.getElementById("_mybricks-geo-webview_"))==null?void 0:jt.shadowRoot);if(!(K||document).querySelector(`style[id="${S}"]`)){const z=document.createElement("style");let G="";z.id=S,rt.forEach(({css:X,selector:g,global:m})=>{g===":root"&&(g="> *:first-child"),G=G+`
            ${m?"":`#${S} `}${g.replace(/\{id\}/g,`${S}`)} {
              ${Object.keys(X).map(d=>{let O=X[d];return i&&typeof O=="string"&&O.indexOf("px")!==-1?O=pxToRem(O):f&&typeof O=="string"&&O.indexOf("px")!==-1&&(O=pxToVw(O)),`${convertCamelToHyphen(d)}: ${O};`}).join(`
`)}
            }
          `}),z.innerHTML=G,K?K.appendChild(z):document.head.appendChild(z)}}Reflect.deleteProperty(h,"styleAry"),Reflect.deleteProperty(h,"themesId");const et=s(y),nt=[],ut={};e.slots&&Object.entries(e.slots).forEach(([K,z])=>{const G=p.get(S,K,x);ut[K]={get size(){var X;return((X=z==null?void 0:z.comAry)==null?void 0:X.length)||0}},nt.push({slotId:K,propsSlot:z,props:G,propsStyle:h,onError:l,logger:r,env:t,_env:o,scope:x,getComDef:s,context:p})}),this.templateSlots=nt;let dt;if(n.frameId&&n.parentComId){const K=p.get(n.parentComId,n.frameId,x==null?void 0:x.parent);K&&(dt={get _inputs(){return new Proxy({},{get(z,G){return K._inputRegs[G]}})}})}const at=this.getClasses({style:h,id:S}),it=this.getSizeStyle({style:h,env:t}),xt=this.getMarginStyle({style:h,env:t}),A={};if(["fixed","absolute"].includes(h.position)){const{top:K,left:z,right:G,bottom:X}=h;(K||isNumber(K))&&(A.top=isNumber(K)?K+"px":K),(X||isNumber(X))&&(A.bottom=isNumber(X)?X+"px":X),(z||isNumber(z))&&(A.left=isNumber(z)?z+"px":z),(G||isNumber(G))&&(A.right=isNumber(G)?G+"px":G),h.position==="fixed"&&(A.zIndex=1e3);const{pxToVw:g}=t;g&&(typeof A.top=="string"&&A.top.indexOf("px")!==-1&&(A.top=pxToVw(A.top)),typeof A.bottom=="string"&&A.bottom.indexOf("px")!==-1&&(A.bottom=pxToVw(A.bottom)),typeof A.left=="string"&&A.left.indexOf("px")!==-1&&(A.left=pxToVw(A.left)),typeof A.right=="string"&&A.right.indexOf("px")!==-1&&(A.right=pxToVw(A.right)))}this.component=et.runtime,this.comDef=et,this.containerProps={id:S,key:S,style:{display:h.display,position:h.position||"relative",...A,...it,...xt,...h.ext||{}}},this.containerClass=at;const wt={id:S,env:{...t,pxToVw},_env:o,data:u,name:b,title:w,slots:ut,propsStyle:h,inputs:_,outputs:$,_inputs:F,_outputs:B,_notifyBindings:q,parentSlot:dt,onError:l,logger:r};this.componentProps={...wt,m:{...wt,style:h}}},methods:{getStyleAry({env:o,def:t,style:e}){var p;const n=(p=o==null?void 0:o.themes)==null?void 0:p.comThemes;if(!n)return e.styleAry;let s;const{themesId:l}=e,{namespace:r}=t;if(l)if(l==="_defined")s=e.styleAry;else{const x=n[r];if(Array.isArray(x)){const i=x.find(({id:f})=>f===l);i&&(s=i.styleAry)}}else{const x=n[r];if(Array.isArray(x)){const i=x.find(({isDefault:f})=>f);i&&(s=i.styleAry)}}return s||e.styleAry},getClasses({style:o,id:t}){const e=[t,this.$style.com];return o.flex===1&&e.push(this.$style.flex),e.join(" ")},getSizeStyle({style:o,env:t}){const e={},{width:n,height:s}=o;n?isNumber(n)?e.width=n+"px":n&&(e.width=n):e.width="100%",isNumber(s)?e.height=s+"px":s&&(e.height=s);const{pxToVw:l}=t;return l&&(typeof e.width=="string"&&e.width.indexOf("px")!==-1&&(e.width=pxToVw(e.width)),typeof e.height=="string"&&e.height.indexOf("px")!==-1&&(e.height=pxToVw(e.height))),e},getMarginStyle({style:o,env:t}){const e={},{width:n,marginTop:s,marginLeft:l,marginRight:r,marginBottom:p}=o;isNumber(s)&&(e.marginTop=s+"px"),isNumber(l)&&(typeof n=="number"||l<0?e.marginLeft=l+"px":e.paddingLeft=l+"px"),isNumber(r)&&(typeof n=="number"||r<0?e.marginRight=r+"px":e.paddingRight=r+"px"),isNumber(p)&&(e.marginBottom=p+"px");const{pxToVw:x}=t;return x&&(typeof e.marginTop=="string"&&e.marginTop.indexOf("px")!==-1&&(e.marginTop=pxToVw(e.marginTop)),typeof e.marginLeft=="string"&&e.marginLeft.indexOf("px")!==-1&&(e.marginLeft=pxToVw(e.marginLeft)),typeof e.marginRight=="string"&&e.marginRight.indexOf("px")!==-1&&(e.marginRight=pxToVw(e.marginRight)),typeof e.marginBottom=="string"&&e.marginBottom.indexOf("px")!==-1&&(e.marginBottom=pxToVw(e.marginBottom)),typeof e.paddingLeft=="string"&&e.paddingLeft.indexOf("px")!==-1&&(e.paddingLeft=pxToVw(e.paddingLeft)),typeof e.paddingRight=="string"&&e.paddingRight.indexOf("px")!==-1&&(e.paddingRight=pxToVw(e.paddingRight))),e},getSlotProps(){}}};var _sfc_render$5=function o(){var t=this,e=t._self._c;return e("div",t._b({class:t.containerClass},"div",t.containerProps,!1),[e(t.component,t._b({tag:"component",scopedSlots:t._u([t._l(t.templateSlots,function(n){return{key:n.slotId,fn:function(s){return[e("SlotRender",t._b({},"SlotRender",{...n,params:s},!1))]}}})],null,!0)},"component",t.componentProps,!1))],1)},_sfc_staticRenderFns$5=[];const __cssModules$2={$style:style0$2};function _sfc_injectStyles$2(o){for(var t in __cssModules$2)this[t]=__cssModules$2[t]}var __component__$5=normalizeComponent(_sfc_main$5,_sfc_render$5,_sfc_staticRenderFns$5,!1,_sfc_injectStyles$2,null,null,null);const RenderCom=__component__$5.exports,slot="_slot_rwhgo_1",lyFlexColumn="_lyFlexColumn_rwhgo_6",lyFlexRow="_lyFlexRow_rwhgo_10",justifyContentFlexStart="_justifyContentFlexStart_rwhgo_14",justifyContentFlexCenter="_justifyContentFlexCenter_rwhgo_17",justifyContentFlexFlexEnd="_justifyContentFlexFlexEnd_rwhgo_20",justifyContentFlexSpaceAround="_justifyContentFlexSpaceAround_rwhgo_23",justifyContentFlexSpaceBetween="_justifyContentFlexSpaceBetween_rwhgo_26",alignItemsFlexStart="_alignItemsFlexStart_rwhgo_29",alignItemsFlexCenter="_alignItemsFlexCenter_rwhgo_32",alignItemsFlexFlexEnd="_alignItemsFlexFlexEnd_rwhgo_35",debugFocus="_debugFocus_rwhgo_38",error="_error_rwhgo_42",errorRT="_errorRT_rwhgo_47",tt="_tt_rwhgo_51",info="_info_rwhgo_57",style0$1={slot,lyFlexColumn,lyFlexRow,justifyContentFlexStart,justifyContentFlexCenter,justifyContentFlexFlexEnd,justifyContentFlexSpaceAround,justifyContentFlexSpaceBetween,alignItemsFlexStart,alignItemsFlexCenter,alignItemsFlexFlexEnd,debugFocus,error,errorRT,tt,info},_sfc_main$4={props:{env:{type:Object},propsStyle:{type:Object},_env:{type:Object},propsSlot:{type:Object},getComDef:{type:Function},context:{type:Object},className:{type:String},onError:{type:Function},logger:{type:Object},root:{type:Boolean},scope:{type:Object},inputs:{type:Object},outputs:{type:Object},_inputs:{type:Object},_outputs:{type:Object},params:{type:Object}},created(){},computed:{comAry(){const{env:o,_env:t,propsSlot:e,context:n,getComDef:s,onError:l,logger:r,scope:p,inputs:x,_inputs:i,outputs:f,_outputs:S}=this.$props,{comAry:y}=e,b=[];return y.forEach((c,u)=>{var rt;const{id:w,def:h,name:_}=c,$=n.getComInfo(w),{hasPermission:F}=o,B=(rt=$==null?void 0:$.model)==null?void 0:rt.permissions;if(B&&typeof F=="function"&&!F(B.id))return;if(s(h)){const et=n.get(w,p,{inputs:x,outputs:f,_inputs:i,_outputs:S}),nt=(p?p.id:"")+u;b.push({id:w,props:{key:nt,com:c,getComDef:s,context:n,scope:p,props:et,env:o,_env:t,onError:l,logger:r},component:RenderCom,name:_,inputs:et.inputsCallable,style:et.style})}else console.error(`组件 (namespace = {${h.namespace}}）未找到.`)}),b},classes(){const{root:o,className:t,params:e,propsStyle:n}=this.$props,l=(e==null?void 0:e.style)||(e==null?void 0:e._style)||n;return`${this.calSlotClasses(l||{})}${o&&t?` ${t}`:""}`},styles(){const{root:o,propsStyle:t,params:e}=this.$props,n=(e==null?void 0:e.style)||(e==null?void 0:e._style),s=n||t;return{...this.calSlotStyles(s||{},!!n,o),...t}}},methods:{calSlotStyles(o,t,e){const{paddingLeft:n,paddingTop:s,paddingRight:l,paddingBottom:r,background:p,backgroundColor:x,backgroundImage:i,backgroundPosition:f,backgroundRepeat:S,backgroundSize:y,...b}=o;let c={paddingLeft:n||0,paddingTop:s||0,paddingRight:l||0,paddingBottom:r||0,backgroundColor:x,backgroundImage:i,backgroundPosition:f,backgroundRepeat:S,backgroundSize:y};if(p)if(typeof p=="object"){const{background:w,backgroundImage:h,backgroundColor:_,backgroundRepeat:$,backgroundSize:F}=p;c.backgroundRepeat=$,c.backgroundSize=F,w?c.background=w:(c.backgroundImage=h,c.backgroundColor=_)}else c.background=p;return t&&(c=Object.assign(c,b)),c},calSlotClasses(o){var s,l;const t=this.$style,e=[t.slot,"slot"],n=o;if(n){((s=n.layout)==null?void 0:s.toLowerCase())=="flex-column"?e.push(t.lyFlexColumn):((l=n.layout)==null?void 0:l.toLowerCase())=="flex-row"&&e.push(t.lyFlexRow);const r=n.justifyContent;r&&(r.toUpperCase()==="FLEX-START"?e.push(t.justifyContentFlexStart):r.toUpperCase()==="CENTER"?e.push(t.justifyContentFlexCenter):r.toUpperCase()==="FLEX-END"?e.push(t.justifyContentFlexFlexEnd):r.toUpperCase()==="SPACE-AROUND"?e.push(t.justifyContentFlexSpaceAround):r.toUpperCase()==="SPACE-BETWEEN"&&e.push(t.justifyContentFlexSpaceBetween));const p=n.alignItems;p&&(p.toUpperCase()==="FLEX-START"?e.push(t.alignItemsFlexStart):p.toUpperCase()==="CENTER"?e.push(t.alignItemsFlexCenter):p.toUpperCase()==="FLEX-END"&&e.push(t.alignItemsFlexFlexEnd))}return e.join(" ")}}};var _sfc_render$4=function o(){var t=this,e=t._self._c;return e("div",{class:t.classes,style:t.styles,attrs:{"data-isslot":"1"}},t._l(t.comAry,function(n){return e(n.component,t._b({key:n.id,tag:"component"},"component",n.props,!1))}),1)},_sfc_staticRenderFns$4=[];const __cssModules$1={$style:style0$1};function _sfc_injectStyles$1(o){for(var t in __cssModules$1)this[t]=__cssModules$1[t]}var __component__$4=normalizeComponent(_sfc_main$4,_sfc_render$4,_sfc_staticRenderFns$4,!1,_sfc_injectStyles$1,null,null,null);const RenderSlot=__component__$4.exports,_sfc_main$3={components:{RenderSlot},props:{json:{type:Object},opts:{type:Object},propsStyle:{type:Object},className:{type:String}},created(){const{json:o,opts:t}=this.$props;this.hasUi=o.rtType!=="js";let e={};t.comDefs&&Object.assign(e,t.comDefs);let n=[...window.__comlibs_edit_||[],...window.__comlibs_rt_||[]];n.push(coreLib),n.forEach(s=>{const l=s.comAray;l&&Array.isArray(l)&&this.regAry(l,e)}),this.comDefs=e;try{let s,l=!0;const r=executor({json:o,getComDef:this.getComDef,events:t.events,env:t.env,ref(p){s=p,typeof t.ref=="function"&&(t.ref(p),l=!1)},onError:this.onError,debug:t.debug,debugLogger:t.debugLogger,logger:this.logger,scenesOperate:t.scenesOperate},{observable:t.observable||Vue.observable});this.context=r,this.refs=s,this.activeTriggerInput=l}catch(s){throw console.error(s),new Error("导出的JSON.script执行异常.")}},mounted(){const{opts:o,json:t}=this.$props;if(!o.disableAutoRun){if(this.activeTriggerInput){const{inputs:e}=this.refs,n=t.inputs;e&&Array.isArray(n)&&n.forEach(s=>{const{id:l,mockData:r}=s;let p;if(o.debug&&typeof r<"u")try{p=JSON.parse(decodeURIComponent(r))}catch{p=r}e[l](p)})}refs.run()}},computed:{logger(){return{...console}},onError(){return o=>{console.error(o)}},props(){const{json:o,opts:t,propsStyle:e,className:n}=this.$props;return{env:t.env,propsStyle:e,_env:t._env,propsSlot:o.slot,getComDef:this.getComDef,context:this.context,className:n,onError:this.onError,logger:this.logger,root:!0}}},methods:{regAry(o,t){o.forEach(e=>{e.comAray?this.regAry(e.comAray,t):t[`${e.namespace}-${e.version}`]=e})},getComDef(o){const{comDefs:t}=this,e=t[o.namespace+"-"+o.version];if(!e){const n=[];for(let s in t)s.startsWith(o.namespace+"-")&&n.push(t[s]);if(n&&n.length>0){n.sort((l,r)=>compareVersion(l.version,r.version));const s=n[0];return console.warn(`【Mybricks】组件${o.namespace+"@"+o.version}未找到，使用${s.namespace}@${s.version}代替.`),s}else throw console.log(t),new Error(`组件${o.namespace+"@"+o.version}未找到，请确定是否存在该组件以及对应的版本号.`)}return e}}};var _sfc_render$3=function o(){var t=this,e=t._self._c;return t.hasUi?e("RenderSlot",t._b({},"RenderSlot",t.props,!1)):t._e()},_sfc_staticRenderFns$3=[],__component__$3=normalizeComponent(_sfc_main$3,_sfc_render$3,_sfc_staticRenderFns$3,!1,null,null,null,null);const Main=__component__$3.exports,main="_main_1oukw_14",slipInto="_slipInto_1oukw_1",style0={main,slipInto},_sfc_main$2={components:{Main},props:{json:{type:Object},opts:{type:Object}},data(){return{count:0,popupIds:[],pageScenes:[]}},created(){const{json:o,opts:t}=this.$props;if(t.sceneId){const r=o.scenes.findIndex(p=>p.id===t.sceneId);if(r!==-1){const p=o.scenes.splice(r,1);o.scenes.unshift(...p),p[0].type==="popup"&&this.setPopupIds([p[0].id])}}const e=[];if(o.scenes.forEach((r,p)=>{r.type==="popup"?p||this.setPopupIds([r.id]):e.push(r)}),this.setPageScenes(e),this.scenesMap=o.scenes.reduce((r,p,x)=>{var i;return{...r,[p.id]:{show:x===0,todo:[],json:p,disableAutoRun:!!x,useEntryAnimation:!1,type:((i=p.slot)==null?void 0:i.showType)||p.type}}},{}),this.scenesOperateInputsTodo={},this.themes=o.themes,this.permissions=o.permissions||[],this.globalVarMap={},t.ref){const r=t.ref;t.ref=p=>x=>(p(x),r.call(t,x))}else t.ref=r=>p=>{r(p)};const n={},s=[],{global:l}=o;if(l){const{fxFrames:r}=l;Array.isArray(r)&&r.forEach(p=>{var c;const{id:x}=p,i={};n[x]=i;const f={...t,env:{...t.env,canvas:Object.assign({id:x,type:(window==null?void 0:window.document.body.clientWidth)<=414?"mobile":"pc",open:async(u,w,h)=>{var $;let _=scenesMap[u];if(!_){if(typeof t.scenesLoader!="function"){console.error(`缺少场景信息: ${u}`);return}const F=await t.scenesLoader({id:u});if(_={disableAutoRun:!1,json:F,show:!1,parentScope:null,todo:[],type:(($=F.slot)==null?void 0:$.showType)||F.type,useEntryAnimation:!1},scenesMap[u]=_,F.type==="popup"||setPageScenes(B=>[...B,F]),scenesOperateInputsTodo[u]){const{parentScope:B,todo:q}=scenesOperateInputsTodo[u];_.parentScope=B,q.forEach(({value:rt,pinId:et,parentScope:nt})=>{_.todo=_.todo.concat({type:"inputs",todo:{pinId:et,value:rt}})})}}h?Object.entries(scenesMap).forEach(([F,B])=>{F===u?(h==="blank"?B.useEntryAnimation=!0:B.useEntryAnimation=!1,B.show=!0,B.type==="popup"?this.setPopupIds([...this.popupIds,u]):setCount(q=>q+1)):(B.show=!1,B.type==="popup"?this.setPopupIds(this.popupIds.filter(q=>q!==B.json.id)):setCount(q=>q+1))}):_.show||(h==="blank"?_.useEntryAnimation=!0:_.useEntryAnimation=!1,_.show=!0,_.type==="popup"?this.setPopupIds([...this.popupIds,u]):setCount(F=>F+1))}},(c=t.env)==null?void 0:c.canvas)},disableAutoRun:!0,ref:t.ref(u=>{i._refs=u;const{inputs:w,outputs:h}=u;p.outputs.forEach(_=>{h(_.id,$=>{var F;(F=i.parentScope)==null||F.outputs[_.id]($)})})}),_env:{loadCSSLazy(){},currentScenes:{close(){}}},scenesOperate:{open({todo:u,frameId:w,parentScope:h}){const _=n[w];_!=null&&_._refs&&(_.parentScope=h,_._refs.inputs[u.pinId](u.value,void 0,!1),_._refs.run())},inputs({frameId:u,parentScope:w,value:h,pinId:_}){const $=scenesMap[u];$?($.parentScope=w,$._refs?$._refs.inputs[_](h):$.todo=$.todo.concat({type:"inputs",todo:{pinId:_,value:h}})):scenesOperateInputsTodo[u]?scenesOperateInputsTodo[u].todo.push({frameId:u,parentScope:w,value:h,pinId:_}):scenesOperateInputsTodo[u]={parentScope:w,todo:[{value:h,pinId:_}]}},_notifyBindings(u,w){const{bindingsTo:h}=w.model;if(h)for(let _ in h)for(let $ in scenesMap){const F=scenesMap[$];if(F.json.coms[_])if(F._refs)this._notifyBindings(F._refs,_,h[_],u);else{const q=h[_];F.todo=F.todo.concat({type:"globalVar",todo:{comId:_,bindings:q,value:u}})}}},getGlobalComProps(u){return scenesMap[o.scenes[0].id]._refs.get(u)},exeGlobalCom({com:u,value:w,pinId:h}){this.globalVarMap[u.id]=w,Object.keys(scenesMap).forEach(_=>{const $=scenesMap[_];if($.show&&$._refs){const F=$._refs.get(u.id);F&&F.outputs[h](w,!0,null,!0)}})}}};let S=l.comsReg,y=l.consReg,b=l.pinRels;Object.keys(S).forEach(u=>{S[u].global=!0}),Object.assign(p.coms,S),Object.assign(p.cons,y),Object.assign(p.pinRels,b),s.push({key:x,component:Main,json:{...p,rtType:"js"},options:f})})}this.fxFramesMap=n,this.fxFramesJsx=s},computed:{scenes(){const{pageScenes:o,scenesMap:t}=this;if(!o.length)return[];const{json:e}=this.$props,{global:n}=e;let s={},l={},r={};return n&&(s=n.comsReg,l=n.consReg,r=n.pinRels,Object.keys(s).forEach(p=>{s[p].global=!0})),o.map((p,x)=>{const{id:i}=p;Object.assign(p.coms,s),Object.assign(p.cons,l),Object.assign(p.pinRels,r);const f=t[i];return{show:f.show,key:i,json:{...p,scenesMap:t},opts:this.options(i),className:f.useEntryAnimation?$style.main:"",style:f.type==="popup"?{position:"absolute",top:0,left:0,backgroundColor:"#ffffff00"}:{}}})},popups(){const{popupIds:o,scenesMap:t}=this;if(!o.length)return[];const{json:e}=this.$props,{global:n}=e;let s={},l={},r={};return n&&(s=n.comsReg,l=n.consReg,r=n.pinRels,Object.keys(s).forEach(p=>{s[p].global=!0})),o.map(p=>{const i=t[p].json,{id:f}=i;return Object.assign(i.coms,s),Object.assign(i.cons,l),Object.assign(i.pinRels,r),{key:i.id,json:{...i,scenesMap:t},opts:this.options(f),style:{position:"absolute",top:0,left:0,backgroundColor:"#ffffff00"}}})}},methods:{setCount(o){this.count=o},setPopupIds(o){this.popupIds=o},setPageScenes(o){this.pageScenes=o},options(o){var x;const{opts:t}=this.$props,{scenesMap:e,themes:n,permissions:s}=this,l=this,r=e[o],p=t.env.hasPermission;return{...t,env:{...t.env,themes:n,permissions:s,hasPermission:typeof p=="function"?i=>{if(typeof i=="string"){const f=s.find(S=>S.id===i);return p({permission:f})}return p(i)}:null,canvas:Object.assign({id:o,type:(window==null?void 0:window.document.body.clientWidth)<=414?"mobile":"pc",open:async(i,f,S)=>{var b;let y=e[i];if(!y){if(typeof t.scenesLoader!="function"){console.error(`缺少场景信息: ${i}`);return}const c=await t.scenesLoader({id:i});if(y={disableAutoRun:!1,json:c,show:!1,parentScope:null,todo:[],type:((b=c.slot)==null?void 0:b.showType)||c.type,useEntryAnimation:!1},e[i]=y,c.type==="popup"||setPageScenes(u=>[...u,c]),scenesOperateInputsTodo[i]){const{parentScope:u,todo:w}=scenesOperateInputsTodo[i];y.parentScope=u,w.forEach(({value:h,pinId:_,parentScope:$})=>{y.todo=y.todo.concat({type:"inputs",todo:{pinId:_,value:h}})})}}S?Object.entries(e).forEach(([c,u])=>{c===i?(S==="blank"?u.useEntryAnimation=!0:u.useEntryAnimation=!1,u.show=!0,u.type==="popup"?l.setPopupIds([...l.popupIds,i]):setCount(w=>w+1)):(u.show=!1,u.type==="popup"?l.setPopupIds(l.popupIds.filter(w=>w!==u.json.id)):setCount(w=>w+1))}):y.show||(S==="blank"?y.useEntryAnimation=!0:y.useEntryAnimation=!1,y.show=!0,y.type==="popup"?l.setPopupIds([...l.popupIds,i]):setCount(c=>c+1))}},(x=t.env)==null?void 0:x.canvas)},get disableAutoRun(){return r.disableAutoRun},ref:t.ref(i=>{r._refs=i;const f=r.todo,{inputs:S,outputs:y}=i,b=r.disableAutoRun;r.json.outputs.forEach(c=>{y(c.id,u=>{var w;r.show=!1,r.todo=[],r._refs=null,(w=r.parentScope)==null||w.outputs[c.id](u),r.parentScope=null,r.type==="popup"?l.setPopupIds(l.popupIds.filter(h=>h!==r.json.id)):setCount(h=>h+1)})}),f.length?(f.forEach(({type:c,todo:u})=>{if(c==="inputs")Promise.resolve().then(()=>{S[u.pinId](u.value,o)});else if(c==="globalVar"){const{comId:w,value:h,bindings:_}=u;l._notifyBindings(i,w,_,h)}}),r.todo=[]):b||(r.disableAutoRun=!0,Promise.resolve().then(()=>{var c,u;(u=(c=r.json.inputs)==null?void 0:c.forEach)==null||u.call(c,w=>{const{id:h,mockData:_}=w;let $;if(t.debug&&typeof _<"u")try{$=JSON.parse(decodeURIComponent(_))}catch{$=_}S[h]($)})})),b&&Promise.resolve().then(()=>{i.run()}),Object.entries(l.globalVarMap).forEach(([c,u])=>{const w=r._refs.get(c);w&&w.outputs.changed(u,!0,null,!0)})}),_env:{loadCSSLazy(){},currentScenes:{close(){r.show=!1,r.todo=[],r._refs=null,r.type==="popup"?(console.log(l,"that"),l.setPopupIds(l.popupIds.filter(i=>i!==r.json.id))):setCount(i=>i+1)}}},scenesOperate:{open({todo:i,frameId:f,parentScope:S}){const y=e[f];if(y)y.show||(y.show=!0,y.todo=y.todo.concat({type:"inputs",todo:i}),y.parentScope=S,y.type==="popup"?l.setPopupIds([...l.popupIds,f]):setCount(b=>b+1));else{const b=fxFramesMap[f];b!=null&&b._refs&&(b.parentScope=S,b._refs.inputs[i.pinId](i.value,void 0,!1),b._refs.run())}},inputs({frameId:i,parentScope:f,value:S,pinId:y}){const b=e[i];b?(b.parentScope=f,b._refs?b._refs.inputs[y](S):b.todo=b.todo.concat({type:"inputs",todo:{pinId:y,value:S}})):scenesOperateInputsTodo[i]?scenesOperateInputsTodo[i].todo.push({frameId:i,parentScope:f,value:S,pinId:y}):scenesOperateInputsTodo[i]={parentScope:f,todo:[{value:S,pinId:y}]}},_notifyBindings(i,f){const{bindingsTo:S}=f.model;if(S)for(let y in S)for(let b in e){const c=e[b];if(c.json.coms[y])if(c._refs)this._notifyBindings(c._refs,y,S[y],i);else{const w=S[y];c.todo=c.todo.concat({type:"globalVar",todo:{comId:y,bindings:w,value:i}})}}},getGlobalComProps(i){return e[json.scenes[0].id]._refs.get(i)},exeGlobalCom({com:i,value:f,pinId:S}){l.globalVarMap[i.id]=f,Object.keys(e).forEach(y=>{const b=e[y];if(b.show&&b._refs){const c=b._refs.get(i.id);c&&c.outputs[S](f,!0,null,!0)}})}}}},_notifyBindings(o,t,e,n){const s=o.get(t);s&&Array.isArray(e)&&e.forEach(l=>{let r=s;const p=l.split(".");p.forEach((x,i)=>{i!==p.length-1?r=r[x]:r[x]=n})})}}};var _sfc_render$2=function o(){var t=this,e=t._self._c;return e("div",[t._l(t.fxFramesJsx,function(n){return e(n.component,{key:n.key,tag:"component",attrs:{json:n.json,opts:n.options}})}),t._l(t.scenes,function(n){return n.show?e("Main",{key:n.key,attrs:{json:n.json,opts:n.opts,className:n.className,propsStyle:n.style}}):t._e()}),t._l(t.popups,function(n){return e("Main",{key:n.key,attrs:{json:n.json,opts:n.opts,className:n.className,propsStyle:n.style}})})],2)},_sfc_staticRenderFns$2=[];const __cssModules={$style:style0};function _sfc_injectStyles(o){for(var t in __cssModules)this[t]=__cssModules[t]}var __component__$2=normalizeComponent(_sfc_main$2,_sfc_render$2,_sfc_staticRenderFns$2,!1,_sfc_injectStyles,null,null,null);const MultiScene=__component__$2.exports;console.log("%c @mybricks/render-web-vue %c@1.0.0","color:#FFF;background:#fa6400","","");const _sfc_main$1={functional:!0,render(o,{props:t}){const n=Array.isArray(t.json.scenes)?MultiScene:Main;return o(n,{props:t},[])}},_sfc_render$1=null,_sfc_staticRenderFns$1=null;var __component__$1=normalizeComponent(_sfc_main$1,_sfc_render$1,_sfc_staticRenderFns$1,!1,null,null,null,null);const Render=__component__$1.exports,_sfc_main={components:{Render},props:{json:{type:Object},opts:{type:Object}}};var _sfc_render=function o(){var t=this,e=t._self._c;return e("Render",t._b({},"Render",this.$props,!1))},_sfc_staticRenderFns=[],__component__=normalizeComponent(_sfc_main,_sfc_render,_sfc_staticRenderFns,!1,null,null,null,null);const App=__component__.exports;function render({json:o,opts:t},e){new Vue({render:n=>n(App,{props:{json:o,opts:t}},[])}).$mount(e)}exports.render=render,Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})});
