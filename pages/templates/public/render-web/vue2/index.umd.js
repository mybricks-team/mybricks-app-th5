(function(o,t){typeof exports=="object"&&typeof module<"u"?t(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],t):(o=typeof globalThis<"u"?globalThis:o||self,t(o._mybricks_render_web_vue2={},o.Vue))})(this,function(exports,Vue){"use strict";var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var comlibCore={exports:{}};(function(module,exports){(function(o,t){module.exports=t()})(commonjsGlobal,()=>(()=>{var __webpack_modules__={356:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function __WEBPACK_DEFAULT_EXPORT__({data,outputs,inputs,onError}){inputs.from((val,relOutpus)=>{var _a;const script=(_a=data.exchange)===null||_a===void 0?void 0:_a.script;if(script){let fn,returnVal,isOk;try{eval(`fn = ${script}`),returnVal=fn(val),isOk=!0}catch(o){console.error(o),onError(`数据转换错误:${o.message}`,o)}isOk&&outputs.to(returnVal)}else onError("未配置转换规则")})}__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__})}},__webpack_module_cache__={};function __webpack_require__(o){var t=__webpack_module_cache__[o];if(t!==void 0)return t.exports;var e=__webpack_module_cache__[o]={exports:{}};return __webpack_modules__[o](e,e.exports,__webpack_require__),e.exports}__webpack_require__.d=(o,t)=>{for(var e in t)__webpack_require__.o(t,e)&&!__webpack_require__.o(o,e)&&Object.defineProperty(o,e,{enumerable:!0,get:t[e]})},__webpack_require__.o=(o,t)=>Object.prototype.hasOwnProperty.call(o,t),__webpack_require__.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})};var __webpack_exports__={};return(()=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>w,getCom:()=>x});const o=JSON.parse('{"title":"Fn计算","namespace":"mybricks.core-comlib.fn","author":"CheMingjun","author_name":"车明君","version":"1.0.0","description":"Fn计算","icon":"./icon.png","runtime":"./Fn.tsx","rtType":"js","visibility":false}'),t=JSON.parse('{"visibility":false,"title":"变量","namespace":"mybricks.core-comlib.var","author":"CheMingjun","author_name":"车明君","version":"1.0.0","description":"变量","icon":"./icon.png","data":"./data.json","runtime":"./Var.tsx","editors":"./editors.tsx","rtType":"js","inputs":[{"id":"get","title":"读取","schema":{"type":"any"},"rels":["return"]},{"id":"set","title":"赋值","schema":{"type":"follow"},"rels":["return"]},{"id":"reset","title":"重置","schema":{"type":"any"}}],"outputs":[{"id":"return","title":"完成","schema":{"type":"unknown"}},{"id":"changed","title":"当值发生变化","schema":{"type":"unknown"}}]}');function e(g){if(g&&typeof g=="object")try{return g instanceof FormData?g:JSON.parse(JSON.stringify(g))}catch{return g}return g}const n=JSON.parse('{"title":"类型转换","visibility":false,"namespace":"mybricks.core-comlib.type-change","author":"CheMingjun","author_name":"车明君","version":"1.0.0","description":"类型转换","icon":"./icon.png","runtime":"./rt.tsx","editors":"./editors.tsx","rtType":"js","inputs":[{"id":"from","title":"从","schema":{"type":"follow"},"rels":["to"]}],"outputs":[{"id":"to","title":"到","schema":{"type":"follow"},"conMax":1,"editable":true}]}');var s=__webpack_require__(356);const l=JSON.parse('{"deprecated":true,"visibility":false,"title":"连接器","namespace":"mybricks.core-comlib.connector","author":"MyBricks","author_name":"MyBricks","version":"1.0.0","description":"连接器","runtime":"./runtime.ts","editors":"./editors.tsx","icon":"./icon.svg","rtType":"js-autorun","inputs":[{"id":"call","rels":["then","catch"],"title":"调用","schema":{"type":"object"}}],"outputs":[{"id":"then","title":"结果","schema":{"type":"unknown"}},{"id":"catch","title":"发生错误","schema":{"type":"string"}}]}');function i({env:g,data:c,outputs:f,onError:S},C={}){if(c.connector)try{g.callConnector(c.connector,C,c.connectorConfig).then(p=>{f.then(p)}).catch(p=>{f.catch(p)})}catch(p){console.error(p),f.catch(`执行错误 ${p.message||p}`)}else f.catch("没有选择接口")}const a=JSON.parse('{"visibility":false,"title":"作用域输入","namespace":"mybricks.core-comlib.frame-input","author":"CheMingjun","author_name":"车明君","version":"1.0.0","description":"作用域输入","rtType":"js","runtime":"./runtime.ts","editors":"./editor.tsx","inputs":[{"id":"getCurValue","title":"获取","schema":{"type":"any"},"rels":["return"]}],"outputs":[{"id":"return","title":"结果","schema":{"type":"follow"}}]}'),b=JSON.parse('{"visibility":false,"title":"打开对话框","namespace":"mybricks.core-comlib.scenes","author":"CheMingjun","author_name":"车明君","version":"1.0.0","description":"切换场景","icon":"./icon.png","runtime":"./runtime.ts","data":"./data.json","rtType":"js","inputs":[{"id":"open","title":"打开","schema":{"type":"any"}}]}'),r={id:"mybricks-core-comlib",title:"Mybrics核心组件库",author:"CheMingjun",icon:"",version:"1.0.1",comAray:[d({comDef:o,rt:function({inputs:g,outputs:c}){}}),d({comDef:t,rt:function({env:g,data:c,outputs:f,inputs:S,_notifyBindings:C}){S.get((p,v)=>{const F=e(c.val!==void 0?c.val:c.initValue);v.return(F)}),S.set((p,v)=>{c.val=p;const F=e(p);f.changed(F,!0),C(F),v.return(F)}),S.reset(()=>{const p=c.initValue;c.val=p;const v=e(p);f.changed(v,!0),C(v)})}}),d({comDef:n,rt:s.Z}),d({comDef:l,rt:function({env:g,data:c,inputs:f,outputs:S,onError:C}){g.runtime&&(c.immediate?i({env:g,data:c,outputs:S}):f.call(p=>{i({env:g,data:c,outputs:S,onError:C},p)}))}}),d({comDef:a,rt:function({env:g,data:c,inputs:f,outputs:S}){g.runtime&&f.getCurValue((C,p)=>{p.return(C)})}}),d({comDef:b,rt:function({env:g,data:c,inputs:f,_inputs:S,_inputsCallable:C}){f.open(p=>{g.canvas.open(c._sceneId,p,c._sceneShowType==="popup"?null:c.openType),C._open(p)})}})]},w=r;function x(g){return r.comAray.find(c=>c.namespace===g)}function d({comDef:g,rt:c,data:f}){return Object.assign(g,{runtime:c,data:f})}})(),__webpack_exports__})())})(comlibCore);var comlibCoreExports=comlibCore.exports;const coreLib=getDefaultExportFromCjs(comlibCoreExports),globalKey="__IOEventList__",ioLogger={log:(...o)=>{window[globalKey]||(window[globalKey]=[]),window[globalKey].push(o[0]),console.log(...o)}};function log(o){console.log(`%c[Mybricks]%c ${o}
`,"color:#FFF;background:#fa6400","","")}function logInputVal(o,t,e,n){let s;try{s=JSON.stringify(n)}catch{s=n}ioLogger.log(`%c[Mybricks] 输入项 %c ${o||t.title||t.namespace} | ${e} -> ${s}`,"color:#FFF;background:#000","","")}function logOutputVal(o,t,e,n){let s;try{s=JSON.stringify(n)}catch{s=n}ioLogger.log(`%c[Mybricks] 输出项 %c ${o||t.title||t.namespace} | ${e} -> ${s}`,"color:#FFF;background:#fa6400","","")}function isNumber(o){return typeof o=="number"&&!isNaN(o)}function uuid$1(o=5,t=8){const e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=[];if(t=t||e.length,o)for(let s=0;s<o;s++)n[s]=e[0|Math.random()*t];else{let s;n[8]=n[13]=n[18]=n[23]="-",n[14]="4";for(let l=0;l<36;l++)n[l]||(s=0|Math.random()*16,n[l]=e[l==19?s&3|8:s])}return n.join("")}function convertCamelToHyphen(o){return o.replace(/([A-Z])/g,"-$1").toLowerCase()}const toFixed=function o(t,e){var n=Math.pow(10,e+1),s=Math.floor(t*n);return Math.round(s/10)*10/n},createPxReplacer=function o(t,e,n,s){return function(l,i){var a=parseFloat(i);return!i||a<=e?l:"".concat(toFixed(a/t,n)).concat(s)}},remReplace=createPxReplacer(12,0,5,"rem"),vwReplace=createPxReplacer(3.75,0,5,"vw"),REG_PX=/"[^"]+"|'[^']+'|url\([^)]+\)|(\d*\.?\d+)px/g,pxToRem=o=>o.replace(REG_PX,remReplace),pxToVw=o=>o.replace(REG_PX,vwReplace);function dataSlim(o){return o}const ROOT_FRAME_KEY="_rootFrame_";function executor(o,{observable:t}){const{json:e,getComDef:n,env:s,ref:l,onError:i,logger:a,debug:b,debugLogger:r,scenesOperate:w}=o,{slot:x,coms:d={},comsAutoRun:g={},cons:c=[],pinRels:f={},pinProxies:S={},pinValueProxies:C={}}=e,p=s,v={},F={},B={},U={},at={};Object.keys(c).forEach(y=>{const m=c[y],{startPinParentKey:_}=m[0];_&&(at[_]=y)});const ot={},Z={};function lt(y,m){if(y==="com"){const{com:_,pinHostId:$,val:h,fromCon:E,notifyAll:u,comDef:j}=m;r?r("com","output",{id:_.id,pinHostId:$,val:h,fromCon:E,notifyAll:u,comDef:j}):logOutputVal(_.title,j,$,h)}else if(y==="frame"){const{comId:_,frameId:$,pinHostId:h,val:E,sceneId:u}=m;r&&r("frame","output",{comId:_,frameId:$,pinHostId:h,val:E,sceneId:u})}}function ut(y){const{com:m,pinHostId:_,val:$,frameKey:h,finishPinParentKey:E,comDef:u}=y;r?r("com","input",{id:m.id,pinHostId:_,val:$,frameKey:h,finishPinParentKey:E,comDef:u}):logInputVal(m.title,u,_,$)}function st(y,m,_,$,h){function E(u,j){var P,T;const O=S[u.comId+"-"+u.pinId];if(O){if(Z[`${O.frameId}-${O.pinId}`]=m,$&&$.finishPinParentKey!==u.startPinParentKey)return;if(O.type==="frame"){const I=rt(u.comId,j);let k;k={id:uuid$1(10,16),frameId:O.frameId,parent:j,proxyComProps:I};const z=u.def.namespace==="mybricks.core-comlib.frame-output";z&&(O.frameId=j.proxyComProps.id,k=j.parent),H(O,m,k),z||K({frameId:O.frameId,scope:k});return}}if(u.type==="com")$?$.finishPinParentKey===u.startPinParentKey&&dt(u,m,j):dt(u,m,j);else if(u.type==="frame"){if($&&$.finishPinParentKey!==u.startPinParentKey)return;if(u.comId){if(u.direction==="inner-input"){const I=F[u.comId+"-"+u.frameId+"-"+((P=j==null?void 0:j.parent)!=null&&P.id?j.parent.id+"-":"")+u.pinId];I&&I(m)}else if(u.direction==="inner-output"&&u.pinType==="joint"){const I=c[u.comId+"-"+u.frameId+"-"+u.pinId];I&&st(I,m)}}else{const I=j==null?void 0:j.proxyComProps;if(I){const k=I.outputs[u.pinId];if(k){k(m,j.parent);return}}(T=U[u.pinId])==null||T.call(U,m)}}else throw new Error("尚未实现")}y.forEach(u=>{if(b&&u.isIgnored)return;let j=_;if(h){const O=u.frameKey;if(!O)throw new Error("数据异常，请检查toJSON结果.");if(O===ROOT_FRAME_KEY)E(u,{});else{const P=O.split("-");if(P.length>=2){const T=_t(P[0],P[1],null,h);T.curScope?(T.curScope!==j&&(j=T.curScope),E(u,j)):T.pushTodo(I=>{I!==j&&(j=I),E(u,j)})}}}else{const O=u.frameKey.split("-");if(O.length>=2&&!j){const P=_t(O[0],O[1],null,!1);if((P==null?void 0:P.type)==="scope"&&!(P!=null&&P.curScope)){P.pushTodo(T=>{T!==j&&(j=T),E(u,j)});return}}E(u,j)}})}function rt(y,m){var Et;const _=d[y];if(!_)return null;const $=y+(_.frameId||ROOT_FRAME_KEY);let h=v[$];h||(h=v[$]={});let E,u=m;for(!u&&_.parentComId&&_.frameId&&(u=(Et=v[`${_.parentComId}-${_.frameId}`])==null?void 0:Et.curScope);u;){const D=u.id+"-"+y;if(u.frameId===_.frameId){E=u.id;const R=h[D];if(R)return R;break}u=u.parent}const j=(E?E+"-":"")+y,O=h[j];if(O)return O;const P=_.def,T=_.model;let I=o?JSON.parse(JSON.stringify(T)):T;const k=t(I),z={},W={},A={},N=(D,R,M,J)=>{let L=W[D];L||(W[D]=L=[]),L.push({val:R,fromCon:M,fromScope:J})},X=function(D){return new Proxy({},{ownKeys(R){return _.inputs},getOwnPropertyDescriptor(R){return{enumerable:!0,configurable:!0}},get(R,M){return function(J){if(Object.prototype.toString.call(M)==="[object Symbol]")return;const L=D==null?void 0:D.inputs;if(L){const q=L[M];typeof q=="function"&&q(J)}z[M]=J;const Y=W[M];Y&&(Y.forEach(({val:q,fromCon:pt,fromScope:mt})=>{J(q,new Proxy({},{get(gt,St){return function(vt){if(Object.prototype.toString.call(St)==="[object Symbol]")return;const ht=ct()[St];if(typeof ht=="function")ht(vt,mt||u,pt);else throw new Error(`outputs.${St} not found`)}}}))}),W[M]=void 0)}}})},Q=new Proxy({},{get(D,R){return function(M){if(Object.prototype.toString.call(R)==="[object Symbol]")return;const J=f[y+"-"+R];if(J){const L={},Y={};return J.forEach(q=>{L[q]=pt=>{Y[q]=pt}}),Promise.resolve().then(()=>{dt({comId:y,def:P,pinId:R},M,m,Y)}),L}else dt({comId:y,def:P,pinId:R},M,m)}}}),it=new Proxy({},{get(D,R){return function(M){if(Object.prototype.toString.call(R)==="[object Symbol]")return;const J=S[y+"-"+R];J&&(w==null||w.inputs({...J,value:M,parentScope:ft}))}}}),ct=function(D){return new Proxy({},{ownKeys(R){return _.outputs},getOwnPropertyDescriptor(R){return{enumerable:!0,configurable:!0}},get(R,M,J){const L=function(Y,q,pt,mt){if(Object.prototype.toString.call(M)==="[object Symbol]")return;const gt=typeof q=="boolean"&&q;if(_.global&&gt&&!mt){w==null||w.exeGlobalCom({com:_,value:Y,pinId:M});return}const St=arguments,vt=D==null?void 0:D.outputs;if(vt){const bt=vt[M];typeof bt=="function"&&bt(Y)}let ht;q&&typeof q=="object"&&(ht=q);const Tt=n(P);lt("com",{com:_,pinHostId:M,val:Y,fromCon:pt,notifyAll:gt,comDef:Tt});const Ft=T.outputEvents;let nt;if(Ft){const bt=Ft[M];if(bt&&Array.isArray(bt)){const It=bt.find($t=>$t.active);if(It){const{type:$t}=It;switch($t){case"none":nt=[];break;case"fx":const Ct=S[y+"-"+M];if((Ct==null?void 0:Ct.type)==="frame"){const xt=`${Ct.frameId}-${Ct.pinId}`;nt=c[xt]||[],Z[xt]=Y}else nt=[];break;case"defined":break;default:if(nt=[],Array.isArray(s==null?void 0:s.events)){const xt=s.events.find(Pt=>{if(Pt.type===$t)return Pt});xt&&typeof xt.exe=="function"&&xt.exe({options:It.options})}break}}}}nt=nt||c[y+"-"+M],nt!=null&&nt.length&&(St.length>=3?st(nt,Y,ht,pt):st(nt,Y,ht||m,pt,gt))};return L.getConnections=()=>c[y+"-"+M]||[],L}})},et=new Proxy({},{get(D,R,M){return function(J){if(Object.prototype.toString.call(R)==="[object Symbol]")return;const L=A[R];L&&(L.forEach(Y=>{J(Y)}),A[R]=void 0)}}}),Ot=new Proxy({},{get(D,R,M){return function(J){if(Object.prototype.toString.call(R)==="[object Symbol]")return;const L=c[y+"-"+R];L&&(lt("com",{com:_,pinHostId:R,val:J,comDef:P}),st(L,J,m))}}});function yt(D){if(_.global){w==null||w._notifyBindings(D,_);return}const{bindingsTo:R}=_.model;if(R)for(let M in R){const J=rt(M);if(J){const L=R[M];Array.isArray(L)&&L.forEach(Y=>{let q=J;const pt=Y.split(".");pt.forEach((mt,gt)=>{gt!==pt.length-1?q=q[mt]:q[mt]=D})})}}}const ft={id:_.id,title:_.title,frameId:_.frameId,parentComId:_.parentComId,data:k.data,style:k.style,_inputRegs:z,addInputTodo:N,inputs:X(),inputsCallable:Q,_inputsCallable:it,outputs:ct(),_inputs:et,_outputs:Ot,clone(D){const R={inputs:X(D),outputs:ct(D)};return Object.setPrototypeOf(R,this),R},_notifyBindings:yt,logger:a,onError:b?D=>i({comId:y,error:D}):i};return h[j]=ft,ft}function wt(y,m){let _=Z[`${y}${m?`-${m.id}-${m.frameId}`:""}`];return typeof _>"u"&&(m!=null&&m.parent)&&(_=wt(y,m.parent)),_}function dt(y,m,_,$){var T;const{comId:h,def:E,pinId:u,pinType:j,frameKey:O,finishPinParentKey:P}=y;if(j==="ext"){const I=v[h]||rt(h,_);if(u==="show")I.style.display="";else if(u==="hide")I.style.display="none";else if(u==="showOrHide"){const z=I.style;typeof m>"u"?z.display==="none"?z.display="":z.display="none":z.display=m?"":"none"}const k=n(E);ut({com:I,val:m,pinHostId:u,frameKey:O,finishPinParentKey:P,comDef:k})}else if(j==="config"){const I=rt(h,_),k=n(E);ut({com:I,pinHostId:u,val:m,frameKey:O,finishPinParentKey:P,comDef:k});const{extBinding:z}=y,W=z.split(".");let A=I;W.forEach((N,X)=>{X!==W.length-1?A=A[N]:A[N]=m})}else if((T=E.rtType)!=null&&T.match(/^js/gi)){const I=d[h];if(I){const k=rt(h,_),z=n(E);if(I.global){const et=w==null?void 0:w.getGlobalComProps(h);et&&(k.data=et.data)}const W=_==null?void 0:_.id,A=(W?W+"-":"")+h;ut({com:I,val:m,pinHostId:u,frameKey:O,finishPinParentKey:P,comDef:z}),B[A]||(B[A]=!0,z.runtime({env:p,data:k.data,inputs:k.inputs,outputs:k.outputs,_notifyBindings:k._notifyBindings,_inputsCallable:k._inputsCallable,logger:a,onError:b?et=>i({comId:h,error:et}):i}));const{realId:N,realVal:X,isReady:Q,isMultipleInput:it}=V(y,m,k);typeof k._inputRegs[N]=="function"&&(it&&Q||!it)&&k._inputRegs[N](X,new Proxy({},{get(et,Ot){return function(yt){if(Object.prototype.toString.call(Ot)!=="[object Symbol]"){if(C){const ft=C[`${h}-${u}`];ft&&(yt=wt(`${O}-${ft.pinId}`,_),typeof yt>"u"&&(yt=wt(`${O}-${ft.pinId}`,null)))}k.outputs[Ot](yt,_,y)}}}}))}}else{const I=rt(h,_);if(!I)return;const k=n(E);ut({com:I,pinHostId:u,val:m,frameKey:O,finishPinParentKey:P,comDef:k});const{realId:z,realVal:W,isReady:A,isMultipleInput:N}=V(y,m,I),X=I._inputRegs[z];if(N&&A||!N)if(typeof X=="function"){let Q;$?Q=$:Q=new Proxy({},{get(it,ct){return function(et){Object.prototype.toString.call(ct)!=="[object Symbol]"&&I.outputs[ct](et,_,y)}}}),X(W,Q)}else I.addInputTodo(z,W,y,_)}if(P){const I=c[at[P]];I&&!f[`${h}-${u}`]&&st(I,void 0)}}function V(y,m,_){const{pinId:$,comId:h}=y,E=$.indexOf(".");if(E!==-1){let u=$.substring(0,E);const j=$.substring(E+1);let O=ot[h];O||(O=ot[h]={}),O[j]=m;const P=new RegExp(`${u}.`),T=Object.keys(_.inputs).filter(I=>!!I.match(P));return Object.keys(O).length===T.length?(delete ot[h],{isMultipleInput:!0,isReady:!0,realId:u,realVal:O}):{isMultipleInput:!0,isReady:!1}}return{isMultipleInput:!1,isReady:!0,realId:$,realVal:m}}function jt(y,m){let _;return y!=null&&y.comAry&&y.comAry.find($=>{if($.id===m)return _=$,$;if($.slots){for(let h in $.slots)if(_=jt($.slots[h],m),_)return _}}),_}function _t(y,m,_,$){let h=y+"-"+m+(_?`-${_.id}`:""),E=v[h];if($&&!E&&(E=v[Object.keys(v).find(u=>u.startsWith(h))]),!E){const u=jt(x,y);if(!(u!=null&&u.slots))return null;const j=u==null?void 0:u.slots[m],O={};let P;if(_){const A=v[y+"-"+m];A&&(P=A.todo)}const T={scope:_,todo:P},I=new Proxy({},{get(A,N){return function(X){Object.prototype.toString.call(N)!=="[object Symbol]"&&(O[N]=X)}}}),k=new Proxy({},{get(A,N){const X=function(Q,it){if(Object.prototype.toString.call(N)==="[object Symbol]")return;const ct=y+"-"+m+"-"+N,et=c[ct];Z[`${ct}${it?`-${it.id}-${it.frameId}`:""}`]=Q,lt("frame",{comId:y,frameId:m,pinHostId:N,val:Q}),et&&st(et,Q,it||T.scope)};return X.getConnections=()=>c[y+"-"+m+"-"+N]||[],X}}),z=new Proxy({},{get(A,N,X){return function(Q){Object.prototype.toString.call(N)!=="[object Symbol]"&&(F[h+"-"+N]=Q)}}});let W={};E=v[h]={type:j==null?void 0:j.type,run(A){T.scope=A;const N=(A==null?void 0:A.id)||"none";W[N]||(W[N]=!0,K({comId:y,frameId:m,scope:A})),Array.isArray(T.todo)&&(T.todo.forEach(X=>{Promise.resolve().then(()=>{X(A)})}),T.todo=void 0)},destroy(){Reflect.deleteProperty(v,h)},_inputs:I,_inputRegs:O,inputs:k,outputs:z,get curScope(){return T.scope},get todo(){return T.todo},pushTodo(A){T.todo||(T.todo=[]),T.todo.push(A)}}}return E}function K(y){const{comId:m,frameId:_,scope:$}=y,h=m?`${m}-${_}`:`${_}`,E=g[h];E&&E.forEach(u=>{const{id:j,def:O}=u;if(d[j]){const T=rt(j,$),I=n(O);log(`${I.namespace} 开始执行`),I.runtime({env:p,data:T.data,inputs:T.inputs,outputs:T.outputs,_inputsCallable:T._inputsCallable,logger:a,onError:b?k=>i({comId:j,error:k}):i})}})}function H(y,m,_=void 0,$=!0){const{frameId:h,comId:E,pinId:u,sceneId:j}=y,O=E?`${E}-${h}`:`${h}`,P=c[O+"-"+u];Z[`${h}-${u}`]=m,$&&lt("frame",{comId:E,frameId:h,pinHostId:u,val:m,sceneId:j}),P?st(P,m,_):h!==ROOT_FRAME_KEY&&(w==null||w.open({frameId:h,todo:{pinId:u,value:m},parentScope:_.proxyComProps}))}const G={get(y,m,_,$){let h,E,u;for(let j=0;j<arguments.length;j++){const O=arguments[j];j>0&&typeof O=="string"&&(h=O),typeof O=="object"&&(O.inputs||O.outputs||O._inputs||O._outputs?u=O:(O.id||O.parent)&&(E=O))}if(h)return _t(y,h,E);{const j=rt(y,E);return u?j.clone(u):j}},getComInfo(y){return d[y]}};return typeof l=="function"&&l({run(){K({frameId:ROOT_FRAME_KEY})},inputs:new Proxy({},{get(y,m){return function(_,$=void 0,h=!0){Object.prototype.toString.call(m)!=="[object Symbol]"&&H({frameId:ROOT_FRAME_KEY,pinId:m,sceneId:$},_,void 0,h)}}}),outputs(y,m){U[y]=m},get:G.get,getComInfo:G.getComInfo}),G}function normalizeComponent(o,t,e,n,s,l,i,a){var b=typeof o=="function"?o.options:o;t&&(b.render=t,b.staticRenderFns=e,b._compiled=!0),n&&(b.functional=!0),l&&(b._scopeId="data-v-"+l);var r;if(i?(r=function(d){d=d||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!d&&typeof __VUE_SSR_CONTEXT__<"u"&&(d=__VUE_SSR_CONTEXT__),s&&s.call(this,d),d&&d._registeredComponents&&d._registeredComponents.add(i)},b._ssrRegister=r):s&&(r=a?function(){s.call(this,(b.functional?this.parent:this).$root.$options.shadowRoot)}:s),r)if(b.functional){b._injectStyles=r;var w=b.render;b.render=function(g,c){return r.call(c),w(g,c)}}else{var x=b.beforeCreate;b.beforeCreate=x?[].concat(x,r):[r]}return{exports:o,options:b}}const _sfc_main$6={props:{slotId:{type:String},propsSlot:{type:Object},params:{type:Object},props:{type:Object},propsStyle:{type:Object},onError:{type:Function},logger:{type:Object},env:{type:Object},_env:{type:Object},scope:{type:Object},getComDef:{type:Function},context:{type:Object}},created(){let o;const{propsSlot:t,scope:e,props:n,env:s,_env:l,getComDef:i,registSpm:a,context:b,onError:r,logger:w,params:x}=this.$props;if(Object.assign(x,x.m),(t==null?void 0:t.type)==="scope"?(o={id:uuid(10,16),frameId:slotId},e&&(o.parent=e)):o=e,x){const d=x.inputValues;if(typeof d=="object")for(let g in d)n.inputs[g](d[g],o);typeof x.wrap=="function"&&x.wrap}n.run(o),this.slotProps={scope:o,env:s,_env:l,propsSlot:t,params:x,getComDef:i,registSpm:a,context:b,inputs:x==null?void 0:x.inputs,outputs:x==null?void 0:x.outputs,_inputs:x==null?void 0:x._inputs,_outputs:x==null?void 0:x._outputs,onError:r,logger:w},this.slotComponent=RenderSlot}};var _sfc_render$6=function o(){var t=this,e=t._self._c;return e(t.slotComponent,t._b({tag:"component"},"component",t.slotProps,!1))},_sfc_staticRenderFns$6=[],__component__$6=normalizeComponent(_sfc_main$6,_sfc_render$6,_sfc_staticRenderFns$6,!1,null,null,null,null);const SlotRender=__component__$6.exports,com="_com_z9da4_2",flex="_flex_z9da4_7",style0$2={com,flex},_sfc_main$5={props:{com:{type:Object},getComDef:{type:Function},registSpm:{type:Function},context:{type:Object},scope:{type:Object},props:{type:Object},env:{type:Object},_env:{type:Object},onError:{type:Function},logger:{type:Object}},components:{SlotRender},created(){var _t;const{_env:o,env:t,com:e,props:n,getComDef:s,registSpm:l,onError:i,logger:a,context:b,scope:r}=this.$props,{pxToRem:w,pxToVw:x}=t,{id:d,def:g,name:c,slots:f={}}=e,{data:S,title:C,style:p,inputs:v,outputs:F,_inputs:B,_outputs:U,_notifyBindings:at}=n,ot=this.getStyleAry({env:t,def:g,style:p});if(Array.isArray(ot)){const K=(t==null?void 0:t.shadowRoot)||((_t=document.getElementById("_mybricks-geo-webview_"))==null?void 0:_t.shadowRoot);if(!(K||document).querySelector(`style[id="${d}"]`)){const H=document.createElement("style");let G="";H.id=d,ot.forEach(({css:y,selector:m,global:_})=>{m===":root"&&(m="> *:first-child"),G=G+`
            ${_?"":`#${d} `}${m.replace(/\{id\}/g,`${d}`)} {
              ${Object.keys(y).map($=>{let h=y[$];return w&&typeof h=="string"&&h.indexOf("px")!==-1?h=pxToRem(h):x&&typeof h=="string"&&h.indexOf("px")!==-1&&(h=pxToVw(h)),`${convertCamelToHyphen($)}: ${h};`}).join(`
`)}
            }
          `}),H.innerHTML=G,K?K.appendChild(H):document.head.appendChild(H)}}Reflect.deleteProperty(p,"styleAry"),Reflect.deleteProperty(p,"themesId");const Z=s(g),lt=[],ut={};e.slots&&Object.entries(e.slots).forEach(([K,H])=>{const G=b.get(d,K,r);ut[K]={get size(){var y;return((y=H==null?void 0:H.comAry)==null?void 0:y.length)||0}},lt.push({slotId:K,propsSlot:H,props:G,propsStyle:p,onError:i,logger:a,env:t,_env:o,scope:r,getComDef:s,context:b})}),this.templateSlots=lt;let st;if(n.frameId&&n.parentComId){const K=b.get(n.parentComId,n.frameId,r==null?void 0:r.parent);K&&(st={get _inputs(){return new Proxy({},{get(H,G){return K._inputRegs[G]}})}})}const rt=this.getClasses({style:p,id:d}),wt=this.getSizeStyle({style:p,env:t}),dt=this.getMarginStyle({style:p,env:t}),V={};if(["fixed","absolute"].includes(p.position)){const{top:K,left:H,right:G,bottom:y}=p;(K||isNumber(K))&&(V.top=isNumber(K)?K+"px":K),(y||isNumber(y))&&(V.bottom=isNumber(y)?y+"px":y),(H||isNumber(H))&&(V.left=isNumber(H)?H+"px":H),(G||isNumber(G))&&(V.right=isNumber(G)?G+"px":G),p.position==="fixed"&&(V.zIndex=1e3);const{pxToVw:m}=t;m&&(typeof V.top=="string"&&V.top.indexOf("px")!==-1&&(V.top=pxToVw(V.top)),typeof V.bottom=="string"&&V.bottom.indexOf("px")!==-1&&(V.bottom=pxToVw(V.bottom)),typeof V.left=="string"&&V.left.indexOf("px")!==-1&&(V.left=pxToVw(V.left)),typeof V.right=="string"&&V.right.indexOf("px")!==-1&&(V.right=pxToVw(V.right)))}this.component=Z.runtime,this.comDef=Z,this.containerProps={id:d,key:d,style:{display:p.display,position:p.position||"relative",...V,...wt,...dt,...p.ext||{}}},this.containerClass=rt;const jt={id:d,env:{...t,pxToVw,spm:l?l==null?void 0:l(d,{title:C,namespace:g.namespace}):null},_env:o,data:S,name:c,title:C,slots:ut,propsStyle:p,inputs:v,outputs:F,_inputs:B,_outputs:U,_notifyBindings:at,parentSlot:st,onError:i,logger:a};this.componentProps={...jt,m:{...jt,style:p}}},methods:{getStyleAry({env:o,def:t,style:e}){var a;const n=(a=o==null?void 0:o.themes)==null?void 0:a.comThemes;if(!n)return e.styleAry;let s;const{themesId:l}=e,{namespace:i}=t;if(l)if(l==="_defined")s=e.styleAry;else{const b=n[i];if(Array.isArray(b)){const r=b.find(({id:w})=>w===l);r&&(s=r.styleAry)}}else{const b=n[i];if(Array.isArray(b)){const r=b.find(({isDefault:w})=>w);r&&(s=r.styleAry)}}return s||e.styleAry},getClasses({style:o,id:t}){const e=[t,this.$style.com];return o.flex===1&&e.push(this.$style.flex),e.join(" ")},getSizeStyle({style:o,env:t}){const e={},{width:n,height:s}=o;n?isNumber(n)?e.width=n+"px":n&&(e.width=n):e.width="100%",isNumber(s)?e.height=s+"px":s&&(e.height=s);const{pxToVw:l}=t;return l&&(typeof e.width=="string"&&e.width.indexOf("px")!==-1&&(e.width=pxToVw(e.width)),typeof e.height=="string"&&e.height.indexOf("px")!==-1&&(e.height=pxToVw(e.height))),e},getMarginStyle({style:o,env:t}){const e={},{width:n,marginTop:s,marginLeft:l,marginRight:i,marginBottom:a}=o;isNumber(s)&&(e.marginTop=s+"px"),isNumber(l)&&(typeof n=="number"||l<0?e.marginLeft=l+"px":e.paddingLeft=l+"px"),isNumber(i)&&(typeof n=="number"||i<0?e.marginRight=i+"px":e.paddingRight=i+"px"),isNumber(a)&&(e.marginBottom=a+"px");const{pxToVw:b}=t;return b&&(typeof e.marginTop=="string"&&e.marginTop.indexOf("px")!==-1&&(e.marginTop=pxToVw(e.marginTop)),typeof e.marginLeft=="string"&&e.marginLeft.indexOf("px")!==-1&&(e.marginLeft=pxToVw(e.marginLeft)),typeof e.marginRight=="string"&&e.marginRight.indexOf("px")!==-1&&(e.marginRight=pxToVw(e.marginRight)),typeof e.marginBottom=="string"&&e.marginBottom.indexOf("px")!==-1&&(e.marginBottom=pxToVw(e.marginBottom)),typeof e.paddingLeft=="string"&&e.paddingLeft.indexOf("px")!==-1&&(e.paddingLeft=pxToVw(e.paddingLeft)),typeof e.paddingRight=="string"&&e.paddingRight.indexOf("px")!==-1&&(e.paddingRight=pxToVw(e.paddingRight))),e},getSlotProps(){}}};var _sfc_render$5=function o(){var t=this,e=t._self._c;return e("div",t._b({class:t.containerClass},"div",t.containerProps,!1),[e(t.component,t._b({tag:"component",scopedSlots:t._u([t._l(t.templateSlots,function(n){return{key:n.slotId,fn:function(s){return[e("SlotRender",t._b({},"SlotRender",{...n,params:s},!1))]}}})],null,!0)},"component",t.componentProps,!1))],1)},_sfc_staticRenderFns$5=[];const __cssModules$2={$style:style0$2};function _sfc_injectStyles$2(o){for(var t in __cssModules$2)this[t]=__cssModules$2[t]}var __component__$5=normalizeComponent(_sfc_main$5,_sfc_render$5,_sfc_staticRenderFns$5,!1,_sfc_injectStyles$2,null,null,null);const RenderCom=__component__$5.exports,slot="_slot_rwhgo_1",lyFlexColumn="_lyFlexColumn_rwhgo_6",lyFlexRow="_lyFlexRow_rwhgo_10",justifyContentFlexStart="_justifyContentFlexStart_rwhgo_14",justifyContentFlexCenter="_justifyContentFlexCenter_rwhgo_17",justifyContentFlexFlexEnd="_justifyContentFlexFlexEnd_rwhgo_20",justifyContentFlexSpaceAround="_justifyContentFlexSpaceAround_rwhgo_23",justifyContentFlexSpaceBetween="_justifyContentFlexSpaceBetween_rwhgo_26",alignItemsFlexStart="_alignItemsFlexStart_rwhgo_29",alignItemsFlexCenter="_alignItemsFlexCenter_rwhgo_32",alignItemsFlexFlexEnd="_alignItemsFlexFlexEnd_rwhgo_35",debugFocus="_debugFocus_rwhgo_38",error="_error_rwhgo_42",errorRT="_errorRT_rwhgo_47",tt="_tt_rwhgo_51",info="_info_rwhgo_57",style0$1={slot,lyFlexColumn,lyFlexRow,justifyContentFlexStart,justifyContentFlexCenter,justifyContentFlexFlexEnd,justifyContentFlexSpaceAround,justifyContentFlexSpaceBetween,alignItemsFlexStart,alignItemsFlexCenter,alignItemsFlexFlexEnd,debugFocus,error,errorRT,tt,info},_sfc_main$4={props:{env:{type:Object},propsStyle:{type:Object},_env:{type:Object},propsSlot:{type:Object},getComDef:{type:Function},registSpm:{type:Function},context:{type:Object},className:{type:String},onError:{type:Function},logger:{type:Object},root:{type:Boolean},scope:{type:Object},inputs:{type:Object},outputs:{type:Object},_inputs:{type:Object},_outputs:{type:Object},params:{type:Object}},created(){},computed:{comAry(){const{env:o,_env:t,propsSlot:e,context:n,getComDef:s,registSpm:l,onError:i,logger:a,scope:b,inputs:r,_inputs:w,outputs:x,_outputs:d}=this.$props,{comAry:g}=e,c=[];return g.forEach((f,S)=>{var ot;const{id:C,def:p,name:v}=f,F=n.getComInfo(C),{hasPermission:B}=o,U=(ot=F==null?void 0:F.model)==null?void 0:ot.permissions;if(U&&typeof B=="function"&&!B(U.id))return;if(s(p)){const Z=n.get(C,b,{inputs:r,outputs:x,_inputs:w,_outputs:d}),lt=(b?b.id:"")+S;c.push({id:C,props:{key:lt,com:f,getComDef:s,registSpm:l,context:n,scope:b,props:Z,env:o,_env:t,onError:i,logger:a},component:RenderCom,name:v,inputs:Z.inputsCallable,style:Z.style})}else console.error(`组件 (namespace = {${p.namespace}}）未找到.`)}),c},classes(){const{root:o,className:t,params:e,propsStyle:n}=this.$props,l=(e==null?void 0:e.style)||(e==null?void 0:e._style)||n;return`${this.calSlotClasses(l||{})}${o&&t?` ${t}`:""}`},styles(){const{root:o,propsStyle:t,params:e}=this.$props,n=(e==null?void 0:e.style)||(e==null?void 0:e._style),s=n||t;return{...this.calSlotStyles(s||{},!!n,o),...t}}},methods:{calSlotStyles(o,t,e){const{paddingLeft:n,paddingTop:s,paddingRight:l,paddingBottom:i,background:a,backgroundColor:b,backgroundImage:r,backgroundPosition:w,backgroundRepeat:x,backgroundSize:d,...g}=o;let c={paddingLeft:n||0,paddingTop:s||0,paddingRight:l||0,paddingBottom:i||0,backgroundColor:b,backgroundImage:r,backgroundPosition:w,backgroundRepeat:x,backgroundSize:d};if(a)if(typeof a=="object"){const{background:S,backgroundImage:C,backgroundColor:p,backgroundRepeat:v,backgroundSize:F}=a;c.backgroundRepeat=v,c.backgroundSize=F,S?c.background=S:(c.backgroundImage=C,c.backgroundColor=p)}else c.background=a;return t&&(c=Object.assign(c,g)),c},calSlotClasses(o){var s,l;const t=this.$style,e=[t.slot,"slot"],n=o;if(n){((s=n.layout)==null?void 0:s.toLowerCase())=="flex-column"?e.push(t.lyFlexColumn):((l=n.layout)==null?void 0:l.toLowerCase())=="flex-row"&&e.push(t.lyFlexRow);const i=n.justifyContent;i&&(i.toUpperCase()==="FLEX-START"?e.push(t.justifyContentFlexStart):i.toUpperCase()==="CENTER"?e.push(t.justifyContentFlexCenter):i.toUpperCase()==="FLEX-END"?e.push(t.justifyContentFlexFlexEnd):i.toUpperCase()==="SPACE-AROUND"?e.push(t.justifyContentFlexSpaceAround):i.toUpperCase()==="SPACE-BETWEEN"&&e.push(t.justifyContentFlexSpaceBetween));const a=n.alignItems;a&&(a.toUpperCase()==="FLEX-START"?e.push(t.alignItemsFlexStart):a.toUpperCase()==="CENTER"?e.push(t.alignItemsFlexCenter):a.toUpperCase()==="FLEX-END"&&e.push(t.alignItemsFlexFlexEnd))}return e.join(" ")}}};var _sfc_render$4=function o(){var t=this,e=t._self._c;return e("div",{class:t.classes,style:t.styles,attrs:{"data-isslot":"1"}},[t._l(t.comAry,function(n){return e(n.component,t._b({key:n.id,tag:"component"},"component",n.props,!1))}),e("div")],2)},_sfc_staticRenderFns$4=[];const __cssModules$1={$style:style0$1};function _sfc_injectStyles$1(o){for(var t in __cssModules$1)this[t]=__cssModules$1[t]}var __component__$4=normalizeComponent(_sfc_main$4,_sfc_render$4,_sfc_staticRenderFns$4,!1,_sfc_injectStyles$1,null,null,null);const RenderSlot=__component__$4.exports,_sfc_main$3={components:{RenderSlot},props:{json:{type:Object},opts:{type:Object},propsStyle:{type:Object},className:{type:String}},created(){const{json:o,opts:t}=this.$props;this.hasUi=o.rtType!=="js";let e={};t.comDefs&&Object.assign(e,t.comDefs);let n=[...window.__comlibs_edit_||[],...window.__comlibs_rt_||[]];n.push(coreLib),n.forEach(s=>{const l=s.comAray;l&&Array.isArray(l)&&this.regAry(l,e)}),this.comDefs=e;try{let s,l=!0;const i=executor({json:o,getComDef:this.getComDef,events:t.events,env:t.env,ref(a){s=a,typeof t.ref=="function"&&(t.ref(a),l=!1)},onError:this.onError,debug:t.debug,debugLogger:t.debugLogger,logger:this.logger,scenesOperate:t.scenesOperate},{observable:t.observable||Vue.observable});this.context=i,this.refs=s,this.activeTriggerInput=l}catch(s){throw console.error(s),new Error("导出的JSON.script执行异常.")}},mounted(){const{opts:o,json:t}=this.$props;if(!o.disableAutoRun){if(this.activeTriggerInput){const{inputs:e}=this.refs,n=t.inputs;e&&Array.isArray(n)&&n.forEach(s=>{const{id:l,mockData:i}=s;let a;if(o.debug&&typeof i<"u")try{a=JSON.parse(decodeURIComponent(i))}catch{a=i}e[l](a)})}refs.run()}},computed:{logger(){return{...console}},onError(){return o=>{console.error(o)}},props(){const{json:o,opts:t,propsStyle:e,className:n}=this.$props;return{env:t.env,propsStyle:e,_env:t._env,registSpm:t.registSpm,propsSlot:o.slot,getComDef:this.getComDef,context:this.context,className:n,onError:this.onError,logger:this.logger,root:!0}}},methods:{regAry(o,t){o.forEach(e=>{e.comAray?this.regAry(e.comAray,t):t[`${e.namespace}-${e.version}`]=e})},getComDef(o){const{comDefs:t}=this,e=t[o.namespace+"-"+o.version];if(!e){const n=[];for(let s in t)s.startsWith(o.namespace+"-")&&n.push(t[s]);if(n&&n.length>0){n.sort((l,i)=>compareVersion(l.version,i.version));const s=n[0];return console.warn(`【Mybricks】组件${o.namespace+"@"+o.version}未找到，使用${s.namespace}@${s.version}代替.`),s}else throw console.log(t),new Error(`组件${o.namespace+"@"+o.version}未找到，请确定是否存在该组件以及对应的版本号.`)}return e}}};var _sfc_render$3=function o(){var t=this,e=t._self._c;return t.hasUi?e("RenderSlot",t._b({},"RenderSlot",t.props,!1)):t._e()},_sfc_staticRenderFns$3=[],__component__$3=normalizeComponent(_sfc_main$3,_sfc_render$3,_sfc_staticRenderFns$3,!1,null,null,null,null);const Main=__component__$3.exports,main="_main_1oukw_14",slipInto="_slipInto_1oukw_1",style0={main,slipInto},_sfc_main$2={components:{Main},props:{json:{type:Object},opts:{type:Object}},data(){return{count:0,popupIds:[],pageScenes:[]}},created(){const{json:o,opts:t}=this.$props;if(t.sceneId){const i=o.scenes.findIndex(a=>a.id===t.sceneId);if(i!==-1){const a=o.scenes.splice(i,1);o.scenes.unshift(...a),a[0].type==="popup"&&this.setPopupIds([a[0].id])}}const e=[];if(o.scenes.forEach((i,a)=>{i.type==="popup"?a||this.setPopupIds([i.id]):e.push(i)}),this.setPageScenes(e),this.scenesMap=o.scenes.reduce((i,a,b)=>{var r;return{...i,[a.id]:{show:b===0,todo:[],json:a,disableAutoRun:!!b,useEntryAnimation:!1,type:((r=a.slot)==null?void 0:r.showType)||a.type}}},{}),this.scenesOperateInputsTodo={},this.themes=o.themes,this.permissions=o.permissions||[],this.globalVarMap={},t.ref){const i=t.ref;t.ref=a=>b=>(a(b),i.call(t,b))}else t.ref=i=>a=>{i(a)};const n={},s=[],{global:l}=o;if(l){const{fxFrames:i}=l;Array.isArray(i)&&i.forEach(a=>{var c;const{id:b}=a,r={};n[b]=r;const w={...t,env:{...t.env,canvas:Object.assign({id:b,type:(window==null?void 0:window.document.body.clientWidth)<=414?"mobile":"pc",open:async(f,S,C)=>{var v;let p=scenesMap[f];if(!p){if(typeof t.scenesLoader!="function"){console.error(`缺少场景信息: ${f}`);return}const F=await t.scenesLoader({id:f});if(p={disableAutoRun:!1,json:F,show:!1,parentScope:null,todo:[],type:((v=F.slot)==null?void 0:v.showType)||F.type,useEntryAnimation:!1},scenesMap[f]=p,F.type==="popup"||setPageScenes(B=>[...B,F]),scenesOperateInputsTodo[f]){const{parentScope:B,todo:U}=scenesOperateInputsTodo[f];p.parentScope=B,U.forEach(({value:at,pinId:ot,parentScope:Z})=>{p.todo=p.todo.concat({type:"inputs",todo:{pinId:ot,value:at}})})}}C?Object.entries(scenesMap).forEach(([F,B])=>{F===f?(C==="blank"?B.useEntryAnimation=!0:B.useEntryAnimation=!1,B.show=!0,B.type==="popup"?this.setPopupIds([...this.popupIds,f]):setCount(U=>U+1)):(B.show=!1,B.type==="popup"?this.setPopupIds(this.popupIds.filter(U=>U!==B.json.id)):setCount(U=>U+1))}):p.show||(C==="blank"?p.useEntryAnimation=!0:p.useEntryAnimation=!1,p.show=!0,p.type==="popup"?this.setPopupIds([...this.popupIds,f]):setCount(F=>F+1))}},(c=t.env)==null?void 0:c.canvas)},disableAutoRun:!0,ref:t.ref(f=>{r._refs=f;const{inputs:S,outputs:C}=f;a.outputs.forEach(p=>{C(p.id,v=>{var F;(F=r.parentScope)==null||F.outputs[p.id](v)})})}),_env:{loadCSSLazy(){},currentScenes:{close(){}}},scenesOperate:{open({todo:f,frameId:S,parentScope:C}){const p=n[S];p!=null&&p._refs&&(p.parentScope=C,p._refs.inputs[f.pinId](f.value,void 0,!1),p._refs.run())},inputs({frameId:f,parentScope:S,value:C,pinId:p}){const v=scenesMap[f];v?(v.parentScope=S,v._refs?v._refs.inputs[p](C):v.todo=v.todo.concat({type:"inputs",todo:{pinId:p,value:C}})):scenesOperateInputsTodo[f]?scenesOperateInputsTodo[f].todo.push({frameId:f,parentScope:S,value:C,pinId:p}):scenesOperateInputsTodo[f]={parentScope:S,todo:[{value:C,pinId:p}]}},_notifyBindings(f,S){const{bindingsTo:C}=S.model;if(C)for(let p in C)for(let v in scenesMap){const F=scenesMap[v];if(F.json.coms[p])if(F._refs)this._notifyBindings(F._refs,p,C[p],f);else{const U=C[p];F.todo=F.todo.concat({type:"globalVar",todo:{comId:p,bindings:U,value:f}})}}},getGlobalComProps(f){return scenesMap[o.scenes[0].id]._refs.get(f)},exeGlobalCom({com:f,value:S,pinId:C}){this.globalVarMap[f.id]=S,Object.keys(scenesMap).forEach(p=>{const v=scenesMap[p];if(v.show&&v._refs){const F=v._refs.get(f.id);F&&F.outputs[C](S,!0,null,!0)}})}}};let x=l.comsReg,d=l.consReg,g=l.pinRels;Object.keys(x).forEach(f=>{x[f].global=!0}),Object.assign(a.coms,x),Object.assign(a.cons,d),Object.assign(a.pinRels,g),s.push({key:b,component:Main,json:{...a,rtType:"js"},options:w})})}this.fxFramesMap=n,this.fxFramesJsx=s},computed:{scenes(){const{pageScenes:o,scenesMap:t}=this;if(!o.length)return[];const{json:e}=this.$props,{global:n}=e;let s={},l={},i={};return n&&(s=n.comsReg,l=n.consReg,i=n.pinRels,Object.keys(s).forEach(a=>{s[a].global=!0})),o.map((a,b)=>{const{id:r}=a;Object.assign(a.coms,s),Object.assign(a.cons,l),Object.assign(a.pinRels,i);const w=t[r];return{show:w.show,key:r,json:{...a,scenesMap:t},opts:this.options(r),className:w.useEntryAnimation?$style.main:"",style:w.type==="popup"?{position:"absolute",top:0,left:0,backgroundColor:"#ffffff00"}:{}}})},popups(){const{popupIds:o,scenesMap:t}=this;if(!o.length)return[];const{json:e}=this.$props,{global:n}=e;let s={},l={},i={};return n&&(s=n.comsReg,l=n.consReg,i=n.pinRels,Object.keys(s).forEach(a=>{s[a].global=!0})),o.map(a=>{const r=t[a].json,{id:w}=r;return Object.assign(r.coms,s),Object.assign(r.cons,l),Object.assign(r.pinRels,i),{key:r.id,json:{...r,scenesMap:t},opts:this.options(w),style:{position:"absolute",top:0,left:0,backgroundColor:"#ffffff00"}}})}},methods:{setCount(o){this.count=o},setPopupIds(o){this.popupIds=o},setPageScenes(o){this.pageScenes=o},options(o){var b;const{opts:t}=this.$props,{scenesMap:e,themes:n,permissions:s}=this,l=this,i=e[o],a=t.env.hasPermission;return{...t,env:{...t.env,themes:n,permissions:s,hasPermission:typeof a=="function"?r=>{if(typeof r=="string"){const w=s.find(x=>x.id===r);return a({permission:w})}return a(r)}:null,canvas:Object.assign({id:o,type:(window==null?void 0:window.document.body.clientWidth)<=414?"mobile":"pc",open:async(r,w,x)=>{var g;let d=e[r];if(!d){if(typeof t.scenesLoader!="function"){console.error(`缺少场景信息: ${r}`);return}const c=await t.scenesLoader({id:r});if(d={disableAutoRun:!1,json:c,show:!1,parentScope:null,todo:[],type:((g=c.slot)==null?void 0:g.showType)||c.type,useEntryAnimation:!1},e[r]=d,c.type==="popup"||setPageScenes(f=>[...f,c]),scenesOperateInputsTodo[r]){const{parentScope:f,todo:S}=scenesOperateInputsTodo[r];d.parentScope=f,S.forEach(({value:C,pinId:p,parentScope:v})=>{d.todo=d.todo.concat({type:"inputs",todo:{pinId:p,value:C}})})}}x?Object.entries(e).forEach(([c,f])=>{c===r?(x==="blank"?f.useEntryAnimation=!0:f.useEntryAnimation=!1,f.show=!0,f.type==="popup"?l.setPopupIds([...l.popupIds,r]):setCount(S=>S+1)):(f.show=!1,f.type==="popup"?l.setPopupIds(l.popupIds.filter(S=>S!==f.json.id)):setCount(S=>S+1))}):d.show||(x==="blank"?d.useEntryAnimation=!0:d.useEntryAnimation=!1,d.show=!0,d.type==="popup"?l.setPopupIds([...l.popupIds,r]):setCount(c=>c+1))}},(b=t.env)==null?void 0:b.canvas)},get disableAutoRun(){return i.disableAutoRun},ref:t.ref(r=>{i._refs=r;const w=i.todo,{inputs:x,outputs:d}=r,g=i.disableAutoRun;i.json.outputs.forEach(c=>{d(c.id,f=>{var S;i.show=!1,i.todo=[],i._refs=null,(S=i.parentScope)==null||S.outputs[c.id](f),i.parentScope=null,i.type==="popup"?l.setPopupIds(l.popupIds.filter(C=>C!==i.json.id)):setCount(C=>C+1)})}),w.length?(w.forEach(({type:c,todo:f})=>{if(c==="inputs")Promise.resolve().then(()=>{x[f.pinId](f.value,o)});else if(c==="globalVar"){const{comId:S,value:C,bindings:p}=f;l._notifyBindings(r,S,p,C)}}),i.todo=[]):g||(i.disableAutoRun=!0,Promise.resolve().then(()=>{var c,f;(f=(c=i.json.inputs)==null?void 0:c.forEach)==null||f.call(c,S=>{const{id:C,mockData:p}=S;let v;if(t.debug&&typeof p<"u")try{v=JSON.parse(decodeURIComponent(p))}catch{v=p}x[C](v)})})),g&&Promise.resolve().then(()=>{r.run()}),Object.entries(l.globalVarMap).forEach(([c,f])=>{const S=i._refs.get(c);S&&S.outputs.changed(f,!0,null,!0)})}),_env:{loadCSSLazy(){},currentScenes:{close(){i.show=!1,i.todo=[],i._refs=null,i.type==="popup"?(console.log(l,"that"),l.setPopupIds(l.popupIds.filter(r=>r!==i.json.id))):setCount(r=>r+1)}}},scenesOperate:{open({todo:r,frameId:w,parentScope:x}){const d=e[w];if(d)d.show||(d.show=!0,d.todo=d.todo.concat({type:"inputs",todo:r}),d.parentScope=x,d.type==="popup"?l.setPopupIds([...l.popupIds,w]):setCount(g=>g+1));else{const g=fxFramesMap[w];g!=null&&g._refs&&(g.parentScope=x,g._refs.inputs[r.pinId](r.value,void 0,!1),g._refs.run())}},inputs({frameId:r,parentScope:w,value:x,pinId:d}){const g=e[r];g?(g.parentScope=w,g._refs?g._refs.inputs[d](x):g.todo=g.todo.concat({type:"inputs",todo:{pinId:d,value:x}})):scenesOperateInputsTodo[r]?scenesOperateInputsTodo[r].todo.push({frameId:r,parentScope:w,value:x,pinId:d}):scenesOperateInputsTodo[r]={parentScope:w,todo:[{value:x,pinId:d}]}},_notifyBindings(r,w){const{bindingsTo:x}=w.model;if(x)for(let d in x)for(let g in e){const c=e[g];if(c.json.coms[d])if(c._refs)this._notifyBindings(c._refs,d,x[d],r);else{const S=x[d];c.todo=c.todo.concat({type:"globalVar",todo:{comId:d,bindings:S,value:r}})}}},getGlobalComProps(r){return e[json.scenes[0].id]._refs.get(r)},exeGlobalCom({com:r,value:w,pinId:x}){l.globalVarMap[r.id]=w,Object.keys(e).forEach(d=>{const g=e[d];if(g.show&&g._refs){const c=g._refs.get(r.id);c&&c.outputs[x](w,!0,null,!0)}})}}}},_notifyBindings(o,t,e,n){const s=o.get(t);s&&Array.isArray(e)&&e.forEach(l=>{let i=s;const a=l.split(".");a.forEach((b,r)=>{r!==a.length-1?i=i[b]:i[b]=n})})}}};var _sfc_render$2=function o(){var t=this,e=t._self._c;return e("div",[t._l(t.fxFramesJsx,function(n){return e(n.component,{key:n.key,tag:"component",attrs:{json:n.json,opts:n.options}})}),t._l(t.scenes,function(n){return n.show?e("Main",{key:n.key,attrs:{json:n.json,opts:n.opts,className:n.className,propsStyle:n.style}}):t._e()}),t._l(t.popups,function(n){return e("Main",{key:n.key,attrs:{json:n.json,opts:n.opts,className:n.className,propsStyle:n.style}})})],2)},_sfc_staticRenderFns$2=[];const __cssModules={$style:style0};function _sfc_injectStyles(o){for(var t in __cssModules)this[t]=__cssModules[t]}var __component__$2=normalizeComponent(_sfc_main$2,_sfc_render$2,_sfc_staticRenderFns$2,!1,_sfc_injectStyles,null,null,null);const MultiScene=__component__$2.exports;console.log("%c @mybricks/render-web-vue %c@0.0.1","color:#FFF;background:#fa6400","","");const _sfc_main$1={functional:!0,render(o,{props:t}){const n=Array.isArray(t.json.scenes)?MultiScene:Main;return o(n,{props:t},[])}},_sfc_render$1=null,_sfc_staticRenderFns$1=null;var __component__$1=normalizeComponent(_sfc_main$1,_sfc_render$1,_sfc_staticRenderFns$1,!1,null,null,null,null);const Render=__component__$1.exports,_sfc_main={components:{Render},props:{json:{type:Object},opts:{type:Object}}};var _sfc_render=function o(){var t=this,e=t._self._c;return e("Render",t._b({},"Render",this.$props,!1))},_sfc_staticRenderFns=[],__component__=normalizeComponent(_sfc_main,_sfc_render,_sfc_staticRenderFns,!1,null,null,null,null);const App=__component__.exports;function render(o,t){return Vue.extend({render:e=>e(App,{props:{json:o,opts:t}})})}window["mybricks-render-vue2"]=function o({json:t,opts:e},n){new Vue({render:s=>s(App,{props:{json:t,opts:e}},[])}).$mount(n)},exports.render=render,Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})});
